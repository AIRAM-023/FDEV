<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/  dc: http://purl.org/dc/terms/  foaf: http://xmlns.com/foaf/0.1/  og: http://ogp.me/ns#  rdfs: http://www.w3.org/2000/01/rdf-schema#  schema: http://schema.org/  sioc: http://rdfs.org/sioc/ns#  sioct: http://rdfs.org/sioc/types#  skos: http://www.w3.org/2004/02/skos/core#  xsd: http://www.w3.org/2001/XMLSchema# ">
  <head>
    <script type="text/javascript" src="/modules/custom/cmatgame_ads_analytics/js/advertisement-ads.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WKRSNN8');</script>
    <!-- End Google Tag Manager -->

    <script type="text/javascript" src="/modules/custom/cmatgame_core/js/lazysizes.min.js" async=""></script>
    <link rel="manifest" href="/manifest.json">

    <meta charset="utf-8" />
<style>/* @see https://github.com/aFarkas/lazysizes#broken-image-symbol */.js img.lazyload:not([src]) { visibility: hidden; }/* @see https://github.com/aFarkas/lazysizes#automatically-setting-the-sizes-attribute */.js img.lazyloaded[data-sizes=auto] { display: block; width: 100%; }</style>
<link rel="canonical" href="//www.coolmathgames.com/0-idle-breakout" />
<meta name="keywords" content="coolmaths, coolmath, math, maths, game, games, free, online, fun, coolmaths, coolmath, math, maths, game, games, free, online, fun, idle, breakout, break, out" />
<meta name="description" content="Idle Breakout at Cool Math Games: Ever play Breakout? Build the ultimate brick-busting machine! Buy and upgrade balls to destroy billions of bricks." />
<meta property="og:description" content="Idle Breakout at Cool Math Games: Ever play Breakout? Build the ultimate brick-busting machine! Buy and upgrade balls to destroy billions of bricks." />
<meta property="og:image" content="https://www.coolmathgames.com/sites/default/files/idle-breakout.png" />
<meta property="og:image:alt" content="Idle Breakout Game Screenshot" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Idle Breakout" />
<meta property="og:url" content="//www.coolmathgames.com/0-idle-breakout" />
<link media="only screen and (max-width: 640px)" rel="alternate" href="//m.coolmathgames.com/0-idle-breakout" />
<link rel="shortcut icon" href="//www.coolmathgames.com/themes/custom/cmatgame/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
	  var valid_test_environment = false;
      function getCookie(key) {
        var keyValue = document.cookie.match("(^|;) ?" + key + "=([^;]*)(;|$)");
        return keyValue ? keyValue[2] : null;
      }
      function setCookie1(cname, cvalue, hours) {
        var d = new Date();
        d.setTime(d.getTime() + (hours*60*60*1000));
        var expires = 'expires='+ d.toUTCString();
        document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/';
      }
      function getParameterByName(name) {
        var regexS = '[\?&]' + name + '=([^&#]*)';
        var regex = new RegExp(regexS);
        var results = regex.exec(location.href);
        if (results === null) {
          return '';
        }
        return decodeURIComponent(results[1].replace(/\+/g, ' '));
      }
      var cmg_gdpr_check = getCookie('GDPR');
      
      var cmg_school_whitelisted = getCookie('cmg_schwl');
      if(cmg_school_whitelisted === null && (typeof valid_test_environment !== 'undefined' && valid_test_environment) && typeof myDebugAction === 'function') {
        cmg_school_whitelisted = myDebugAction();
      }

      var freeTrialUser = false;
      var date = new Date();
      var hours = date.getHours();
      var currentMonth = date.getMonth();
      var currentYear = date.getFullYear();
      var day = date.getDay();
      var month_names_short = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
      var currentMonthName = month_names_short[currentMonth];
      var schoolStartHour = 7;
      var schoolEndHour = 15;
      var cmg_no_ads_debug = false;
      //var cmg_no_ads = false;
      if(typeof subscriberLeg === 'undefined' || subscriberLeg === null || subscriberLeg === '') {
        subscriberLeg = 'Default Leg';
        if(typeof myDebugAction === 'function' && (typeof valid_test_environment !== 'undefined' && valid_test_environment) ) {
          myDebugAction();
        }
      }
      if(typeof freeGameLimit === 'undefined' || freeGameLimit === null) {
        freeGameLimit = 0;
      }
      if(typeof cmg_no_ads === 'undefined' && cmg_no_ads_debug && (typeof valid_test_environment !== 'undefined' && valid_test_environment)) {
        cmg_no_ads = true;
      }
      var schoolHours = false;
      var schoolHolidays = ["Jul 4","Sep 3","Nov 22","Nov 23"];
      var schoolHoliday = false;

      //TODO -- Summer vacation dates
      var summerVacationStart = new Date('07/1/'+currentYear);
      var summerVacationEnd = new Date('07/10/'+currentYear);
      
      var today_month_day = currentMonthName + ' ' + date.getDate();
      if(schoolHolidays.indexOf(today_month_day) !== -1 || (date >= summerVacationStart && date <= summerVacationEnd) || day === 6 || day == 0) {
        schoolHoliday = true;
      }
      var currentMonthName = month_names_short[currentMonth];
      if(!schoolHoliday && hours >= schoolStartHour && hours <= schoolEndHour) {
        schoolHours = true;
      }
      var targetStateUser = false;
      if(typeof targeted_state !== 'undefined' && targeted_state !== null && targeted_state) {
        targetStateUser = true;
      }
      if(typeof watchAdtoUnlockGame == 'undefined') {
        watchAdtoUnlockGame = false;
      }
      var cmg_active_anonymous_user = getCookie('cmg_active_anonymous_user');
      var cmatgame_editor = getCookie('cmg_editor');
      if(typeof cmg_active_anonymous_user !== 'undefined' && cmg_active_anonymous_user !== null) {
        ////console.log('We have an active school hours session');
      }
      //Display Ads to anonymous users only if the user is not from a targeted state or it is school hours.
      //   Do not display ads for targeted state user during non school hours, but free game play is restricted
      if(!schoolHours && targetStateUser && cmg_active_anonymous_user === null && cmatgame_editor === null) {
        freeTrialUser = true;
     }
   </script>
<script type="text/javascript">
	   function checkIfFlashIsEnabled() {
          var ie_flash;
          try { ie_flash = (window.ActiveXObject && (new ActiveXObject("ShockwaveFlash.ShockwaveFlash")) !== false) } catch(err) { ie_flash = false; }
          var _flash_installed = ((typeof navigator.plugins != "undefined" && typeof navigator.plugins["Shockwave Flash"] == "object") || ie_flash);
          if(typeof _flash_installed == "undefined" || !_flash_installed) {
            return false;
          } else {
            return true;
          }
       }
       function trackEvent(category, action, label, noninteraction) {
          if(typeof __gaTracker === 'undefined')
            return;
            noninteraction = noninteraction || 0;
           //console.log('Tracked: ' + category + ' ' + action + ' ' + label + ' noninteraction: ' + noninteraction);
          __gaTracker('send', {
              'hitType': 'event',          // Required.
              'eventCategory': category,   // Required.
              'eventAction': action,      // Required.
              'eventLabel': label,
              'eventValue': 0,
              'nonInteraction': noninteraction
          });
      }
      function trackSocial(network,action,target) {
          if(typeof __gaTracker === 'undefined')
            return;
          __gaTracker('send', {
              'hitType': 'social',          // Required.
              'socialNetwork': network,
              'socialAction': action,
              'socialTarget': target
          });
      }
	  </script>
<script src="/modules/custom/cmatgame_ads_analytics/js/jquery.min.js?v=3.2.1"></script>
<script type="text/javascript">
		  gamePage = true;
          quizPage = false;
		  gameType = 'game_html5';
		  game_width_size = 800;
		  mobile_ga_game_type = 'Desktop'; 
          var ad_refresh_timer_interval = 60000; 
          var ad_refresh_event_interval = 30000;
		  </script>
<script type="text/javascript">
		  var hide_preroll_ads = false; 
          var preroll_ads_timer = 15;
		  
          cmatgame_subscriber = getCookie("cmg_sx");
		      if(getCookie("cmg_wl") !== null) {
		        cmatgame_subscriber = getCookie("cmg_wl");
          }
          //check if school is whitelisted
          if(cmg_school_whitelisted !== null && getCookie("cmg_schwl") !== null) {
            cmg_school_whitelisted = getCookie("cmg_schwl");
            cmatgame_subscriber = getCookie("cmg_schwl");
          } else if(cmg_school_whitelisted === null && typeof cmg_no_ads_debug !== "undefined" && cmg_no_ads_debug) {
           //console.log("KY school hours");
           cmatgame_subscriber = cmg_no_ads_debug;
          }
          if(cmg_gdpr_check !== null) {
            var cmg_gdpr_all_check = getCookie("GDPR_All");  //GDPR_All cookie is set when user selects accept all cookies in the GDPR overlay
            var cmg_gdpr_first_check = getCookie("GDPR_First");
            var cmg_gdpr_reject_check = getCookie("GDPR_Reject");
            if(cmg_gdpr_all_check == null && (cmg_gdpr_first_check != null || cmg_gdpr_reject_check !=null)) {  //user either accepted only first party cookies or rejected all cookies so do not display ads
              cmatgame_subscriber = getCookie("GDPR");
            }
          }
          isRemoveAdSwfJWPLayer = false;
          jQuery(document).ready(function() {
          if(typeof isAdblockerOn === "undefined"){
            if(typeof __gaTracker !== "undefined") {
             __gaTracker("send", {
              "hitType": "event",          // Required.
              "eventCategory": "Page-level-ad-blocker2",   // Required.
              "eventAction": "AdBlockerDetected",      // Required.
              "eventLabel": document.title,
              "eventValue": 1,
              "nonInteraction": 1
              });
            }
          } else {
           if(typeof __gaTracker !== "undefined") {
              __gaTracker("send", {
                "hitType": "event",          // Required.
                "eventCategory": "Page-level-ad-blocker2",   // Required.
                "eventAction": "AdBlockerNotDetected",      // Required.
                "eventLabel": document.title,
                "eventValue": 1,
                "nonInteraction": 1
            });
           }
         }
		 function removeAdSwfJWPLayer() {}
         var isChrome = navigator.userAgent.toLowerCase().indexOf("chrome") > -1;
         if(!jQuery(".adtxt").is(":visible") && isChrome) {
           removeAdSwfJWPLayer();
         }
        });
        </script>
<script type="text/javascript">
           if((typeof cmatgame_subscriber === "undefined" ||
		   cmatgame_subscriber === "" ||
	       cmatgame_subscriber === null ||
	       typeof freeTrialUser === "undefined"  ) && !freeTrialUser) {
				var pwUnits = [];
				var windowPath = window.location.pathname;
			   	// category landing pages with video
			    if( windowPath == "/1-strategy-games" ||
				    windowPath == "/1-skill-games" ||
				    windowPath == "/1-number-games" ||
				    windowPath == "/1-logic-games" ||
				    windowPath == "/1-playlists" ||
				    windowPath == "/1-daily-games" ||
				    windowPath == "/1-complete-game-list" || windowPath == "/profile/leaderboard") {
					var tyche = {
				         			mode: "tyche",
				         			config: "//config.playwire.com/1023174/v2/websites/71134/banner.json",
				         			forcePath: "trendi-video",
				         			passiveMode: true
				                };
				    pwUnits = [{
						  selectorId: "leaderboard-atf",
						  type: "leaderboard_atf"
						},
						{
						  selectorId: "leaderboard-btf",
						  type: "leaderboard_btf"
						},
						{
						  selectorId: "med-rect-atf",
						  type: "med_rect_atf"
						},
						{
						  selectorId: "med-rect-btf",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "sky-atf",
						  type: "sky_atf"
						},
						{
						  selectorId: "sky-btf",
						  type: "sky_btf"
						},
						{
						  type: "trendi_video"
						}
					];
				// Homepage, category landing pages without video
			   	}else if( windowPath == "/" ||
			    	      windowPath == "/1-playlists" ||
			    	      windowPath == "/0-jigsaw-puzzles" ||
			    	      windowPath == "/1-mobile-categories") {
			    	var tyche = {
			       					mode: "tyche",
			       					config: "//config.playwire.com/1023174/v2/websites/71134/banner.json",
			       					passiveMode: true
			    	};
			    	pwUnits = [{
						  selectorId: "leaderboard-atf",
						  type: "leaderboard_atf"
						},
						{
						  selectorId: "leaderboard-btf",
						  type: "leaderboard_btf"
						},
						{
						  selectorId: "med-rect-atf",
						  type: "med_rect_atf"
						},
						{
						  selectorId: "med-rect-btf1",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "med-rect-btf2",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "med-rect-btf3",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "med-rect-btf4",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "sky-atf",
						  type: "sky_atf"
						},
						{
						  selectorId: "sky-btf",
						  type: "sky_btf"
						}
					];
				// all other pages
				} else  {
					var tyche = {
			       					mode: "tyche",
			       					config: "//config.playwire.com/1023174/v2/websites/71134/banner.json",
			       					passiveMode: true
			    	};
					pwUnits = [{
						  selectorId: "leaderboard-atf",
						  type: "leaderboard_atf"
						},
						{
						  selectorId: "leaderboard-btf",
						  type: "leaderboard_btf"
						},
						{
						  selectorId: "med-rect-atf",
						  type: "med_rect_atf"
						},
						{
						  selectorId: "med-rect-btf",
						  type: "med_rect_btf"
						},
						{
						  selectorId: "sky-atf",
						  type: "sky_atf"
						},
						{
						  selectorId: "sky-btf",
						  type: "sky_btf"
						}
					];
				}
				// function that is called when tyche is ready
				var loadUnits = function () {
				  var timeout = 1500; // How long before calling ad units in ms
				  setTimeout(function () {
				    tyche
				    .addUnits(pwUnits)
				    .then(function(){
				        tyche.displayUnits();
				    }).catch( function(e){
				    	tyche.displayUnits();
				    	console.log(e);
					});
				  }, timeout);
				}
				tyche.onReady = function () { // attach function to tyche onReady
				  loadUnits();
				}
			   var pwScript = document.createElement("script");
			   pwScript.type = "text/javascript";
			   pwScript.src = "//cdn.intergi.com/hera/tyche.js";
			   pwScript.async = true;
			   document.getElementsByTagName("head")[0].appendChild(pwScript);
			}
          </script>
<script type="text/javascript">
          var $elements_with_events = jQuery('.js-track');
          if($elements_with_events.length > 0) {
            $elements_with_events.each(function(){
            var action = typeof jQuery(this).data('action') !== 'undefined' ? jQuery(this).data('action') : 'click';
            jQuery(this).on(action, function(){
            var category, label;
            category = typeof jQuery(this).data('category') !== 'undefined' ? jQuery(this).data('category') : ( jQuery(this).text() || 'Unassigned' );
            label = typeof jQuery(this).data('label') !== 'undefined' ? jQuery(this).data('label') :  ( jQuery(this).attr('class') || 'Unassigned' );
            trackEvent(category,'click',label);
           });
         });
        }
       </script>

      <title>Idle Breakout - Play it now at CoolmathGames.com</title>
      <link rel="stylesheet" media="all" href="/sites/default/files/css/css_5UN3Tj0uGvDVmcWySH6kotMkwmR-mPxWpbmp8RBb-8A.css" />
<link rel="stylesheet" media="all" href="/sites/default/files/css/css_3bxksS0bIUhidU0zjjlXtOhZbZDWTbmo0Fm808bxr_0.css" />
<link rel="stylesheet" media="all" href="/styleswitcher/css/cmatgame?qjytpo" id="styleswitcher-css" />

        <script type="text/javascript">
          var userAgent = window.navigator.userAgent.toLowerCase();
          if(userAgent.indexOf('macintosh') > -1 && 'ontouchend' in document) {  //Mobile
            if(window.location.hostname.indexOf("d8-dev.coolmathgames") != -1) {  //stage
              window.location = "https://d8-m-dev.coolmathgames.com" + window.location.pathname;
            } else if(window.location.hostname.indexOf("www.coolmathgames") != -1) { //prod
              window.location = "https://m.coolmathgames.com" + window.location.pathname;
            }
          }
        </script>
        <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/12640","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","suppressDeprecationErrors":true,"clientside_validation_jquery":{"validate_all_ajax_forms":2,"force_validate_on_blur":false},"lazy":{"lazysizes":{"lazyClass":"lazyload","loadedClass":"lazyloaded","loadingClass":"lazyloading","preloadClass":"lazypreload","errorClass":"lazyerror","autosizesClass":"lazyautosizes","srcAttr":"data-src","srcsetAttr":"data-srcset","sizesAttr":"data-sizes","minSize":40,"customMedia":[],"init":true,"expFactor":1.5,"hFac":0.8000000000000000444089209850062616169452667236328125,"loadMode":2,"loadHidden":true,"ricTimeout":0,"throttleDelay":125,"plugins":[]},"placeholderSrc":"","preferNative":false},"userprofile":{"ualn":{"2":"Retro Pong Kitty","8":"Truck Loader","14":"Hangman","20":"Sun for the Vampire","26":"Olympic Jumper","32":"The Runner"},"utln":{"35":"Cosmic","17":"The Birds","23":"Overgrown","29":"Let\u0027s Go","5":"Frosty","11":"Pedal Power"},"uali":{"2":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/Pong-Kitty-Nolines_0.png?itok=6-_9-9Kb","8":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/Truck-Loader.png?itok=PseCe9IO","14":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/Hangman.png?itok=nwTXFMjt","20":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/Sun-For-The-Vampire.png?itok=FTOUpUzC","26":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/Olympic-Jump.png?itok=7sQlyc0L","32":"\/sites\/default\/files\/styles\/avatar_full_size\/public\/profile_avatars\/run3-avatar-02_2_0.png?itok=gklDQVBn"},"utli":{"5":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-frosty.png","11":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-pedal-power.png","17":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-the-birds.png","23":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-overgrown.png","29":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-lets-go.png","35":"\/themes\/custom\/coolmath\/assets\/themes\/images\/thumbnail-cosmic.png"}},"cmatgame":{"gamePlaylistCount":1897,"html5embed":{"width":"800","height":"600","game":{"u":"sites\/default\/files\/games\/idle-breakout-04-08-2019.zip"}},"swfembed":"","isSubscriptionActive":false},"user":{"uid":0,"permissionsHash":"10d61b137c4f914b655d7628788e0db136577254c17eb9fe2565b5c80c7820df"}}</script>

<!--[if lte IE 8]>
<script src="/sites/default/files/js/js_VtafjXmRvoUgAzqzYTA3Wrjkx9wcWhjP0G4ZnnqRamA.js"></script>
<![endif]-->
<script src="/sites/default/files/js/js_QyQLiqSTVQuNN8kkAOaqaXGYWG4EW_bREKO9zJEn-V4.js"></script>
<script src="https://js.stripe.com/v3/"></script>
<script src="/sites/default/files/js/js_GRxEFZJqOrQALE1nVJHXukyXY7TnJ3faBZ5FFak0wnA.js"></script>

        <script type="text/javascript" src="/modules/custom/cmatgame_userprofile/js/userprogress.js"></script>
        <script type="text/javascript" src="//cdn.pushwoosh.com/webpush/v3/pushwoosh-web-notifications.js" async></script>
        <script type="text/javascript">
        // var displayPushWooshNotification = true;
        if(typeof displayPushWooshNotification !== 'undefined'){
          console.log('present');
        if(location.hostname == "d8-stage.coolmathgames.com" || location.hostname == "d8.coolmathgames.local"){
            applicationCode = "0A16D-69CC2";
            console.log('stage');
          } else { //live
            applicationCode = "BDAD7-8E616";
          }
          var Pushwoosh = Pushwoosh || [];
          Pushwoosh.push(['init', {
              logLevel: 'info',
              applicationCode: applicationCode,
              defaultNotificationTitle: 'Pushwoosh',
              defaultNotificationImage: 'https://www.coolmathgames.com/themes/custom/cmatgame/logo.png',
              autoSubscribe: true, // or true. If true, prompts a user to subscribe for pushes upon SDK initialization
              subscribeWidget: {
                enabled: true
              },
          }]);
        }
        </script>
        </head>
        <body class="route-entitynodecanonical path-_-idle-breakout node-type-game large-game-item game-centered">
                    <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WKRSNN8"
          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          <a href="#main-content" class="visually-hidden focusable">
            Skip to main content
          </a>
           
          <script type="text/javascript">
            jQuery(document).ready(function() {
              cmg_gdpr_check = getCookie("GDPR");
              cmg_gdpr_all_check = getCookie("GDPR_All");
              cmg_gdpr_first_check = getCookie("GDPR_First");
              cmg_gdpr_reject_check = getCookie("GDPR_Reject");
              if (cmg_gdpr_check != null && cmg_gdpr_check == "true") {
                if (cmg_gdpr_all_check == null && cmg_gdpr_first_check == null && cmg_gdpr_reject_check == null) { // user is visiting our site firsttime from one of GDPR countries
                  jQuery("#yourCookieChoices").show();
                  //remove_ads_from_free_game_pages(); jQuery('.content-wrapper').css('pointer-events','default');
                } else if (cmg_gdpr_first_check !== null || cmg_gdpr_reject_check !== null) { //user selected first party cookies or rejected all cookies so we need to remove ads
                  remove_ads_from_free_game_pages();
                  var footerlink = '<li class="menu__item is-leaf last leaf"><a href="/cookie-choices" class="menu__link">Your Cookie Choices</a></li>';
                  jQuery(".footer-menu-column-0 .footer-menu").append(footerlink);
                  //jQuery('.content-wrapper').css('pointer-events','default');
                } else if (cmg_gdpr_all_check !== null) { //user accepted all cookies
                  var footerlink = '<li class="menu__item is-leaf last leaf"><a href="/cookie-choices" class="menu__link">Your Cookie Choices</a></li>';
                  jQuery(".footer-menu-column-0 .footer-menu").append(footerlink);
                }
              }
            });
          </script>
                      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
    <script>
  //initialize js variableswith current theme style
  //var user_stylePath = encodeURIComponent("");
  //var path = location.protocol + "//"+ location.host + "/" +decodeURIComponent(user_stylePath);
  //jQuery('#styleswitcher-css').attr('href', path);
  
  //jQuery(document).ready(function() {
    if(typeof getCookie === 'function' && getCookie('cmg_xpp') !== null) {
      jQuery('body').addClass('cmatgame');
      var path = "/" + decodeURIComponent (getCookie('cmg_xpp'));
      if(jQuery('#styleswitcher-css').length) {
      	jQuery('#styleswitcher-css').attr('href', path);
      	console.log("Loading userprofile theme... "+path);
      }
    }
  //});
</script>

<div class="global-wrapper">
  <div class="global-content-wrapper">
    
<header class="page__header">
  <div class="branding container">
    <div class="row">
              <div class="other-sites-wrapper col-lg-3 d-none d-lg-block pl-0">
          <div class="panel-pane pane-block pane-bean-new-go-ad-free">
            <a id="cmg-goadfree" onclick="goadfree_event_handler()" href="#">Go Ad Free!</a>
          </div>
          <div
            class="pane-bean-cm-top">
            
            <a href="https://www.coolmath4kids.com"><img src="/themes/custom/cmatgame/images/cmatgameimages/math-games-for-kids.png" alt="math-games-for-kids.png"></a>
          </div>
        </div>
        <div class="logo-container col-lg-6 ">
          <a href="/" title="Home" rel="home" class="site-branding__logo">
                        <img src="/themes/custom/coolmath/logo.svg" alt="Home" class="logo svg"/>
          </a>
                              
      </div>
      <div class="right-header-block col-lg-3 pr-0">
        
<!-- user-avatar-form.twig -->
<div class="welcome-box d-none d-lg-block d-xl-block">
      <a href="/signup" class="btn free-account" title="Get a Free Account">Get a Free Account
      <span>Save progress | Earn XP | Custom profile</span>
    </a>
  </li>
  <div class="login-link">
    <p>or
    <a href="/login" title="Log in" class="login">Log In</a></p>
  </div>
</div>
      </div>
    </div>
  </div>
<nav class="navbar navbar-expand-lg justify-content-between d-none d-lg-block">
  <div class="container">
      <nav role="navigation" aria-labelledby="block-desktopheadermenu-menu" id="block-desktopheadermenu">
            
  <h2 class="visually-hidden" id="block-desktopheadermenu-menu">Desktop Header menu</h2>
  

        
			<div class="pane-menu-menu-desktop-header-menu">
			<div class="pane-content">
																		<ul class="menu">
																																														<li  class="menu_strategy menu__link">
																																																							<a href="/1-strategy-games" class="menu_strategy menu__link" data-drupal-link-system-path="taxonomy/term/6">Strategy</a>
																													</li>
																																																<li  class="menu_skill menu__link">
																																																							<a href="/1-skill-games" class="menu_skill menu__link" data-drupal-link-system-path="taxonomy/term/46">Skill</a>
																													</li>
																																																<li  class="menu_numbers menu__link">
																																																							<a href="/1-number-games" class="menu_numbers menu__link" data-drupal-link-system-path="taxonomy/term/151">Numbers</a>
																													</li>
																																																<li  class="menu_logic menu__link">
																																																							<a href="/1-logic-games" class="menu_logic menu__link" data-drupal-link-system-path="taxonomy/term/91">Logic</a>
																													</li>
																																																<li  class="menu_trivia menu__link">
																																																							<a href="/trivia" class="menu_trivia menu__link" data-drupal-link-system-path="trivia">Trivia</a>
																													</li>
																							<li class="menu__item is-expanded expanded">
																													<span  class="menu_more menu__link nolink">More</span>
																																															<div class="expandable-wrapper">
										<ul class="menu">
																																<li class="nested">
																																									<a href="/1-classic-games" class="menu_classic menu__link" data-drupal-link-system-path="taxonomy/term/211">Classic</a>
																													</li>
																																		<li class="nested">
																																									<a href="/1-word-games" class="menu_word games menu__link" data-drupal-link-system-path="taxonomy/term/1059">Word Games</a>
																													</li>
																																		<li class="nested">
																																									<a href="/0-jigsaw-puzzles" class="menu_puzzles menu__link" data-drupal-link-system-path="0-jigsaw-puzzles">Puzzles</a>
																													</li>
																																		<li class="nested">
																																									<a href="/1-memory-games" class="menu_memory menu__link" data-drupal-link-system-path="taxonomy/term/181">Memory</a>
																													</li>
																																		<li class="nested">
																																									<a href="/1-geography-games" class="menu_geography menu__link" data-drupal-link-system-path="taxonomy/term/206">Geography</a>
																													</li>
																																		<li class="nested">
																																									<a href="/1-science-games" class="menu_science menu__link" data-drupal-link-system-path="taxonomy/term/626">Science</a>
																													</li>
															</ul>
														</div>
																		
																			</li>
																																																<li  class="menu_playlists menu__link">
																																																							<a href="/1-playlists" class="menu_playlists menu__link" data-drupal-link-system-path="1-playlists">Playlists</a>
																													</li>
																																																<li  class="menu_random menu__link random-redirect">
																																																							<a href="/random" class="menu_random menu__link random-redirect" data-drupal-link-system-path="random">Random!</a>
																													</li>
																																																<li  class="menu_unlocked menu__link">
																																																							<a href="/1-daily-games" class="menu_unlocked menu__link" data-drupal-link-system-path="taxonomy/term/1056">Daily Games</a>
																													</li>
																																															<li>
																																																						<a href="/1-complete-game-list" class="menu_allgames menu__link" data-drupal-link-system-path="1-complete-game-list">All Games A-Z</a>
																													</li>
															</ul>
																						</div>
				</div>
					

  </nav>


    <div class="panel-pane pane-block pane-cmatgame-search-search-game">
      <div id="cmatgame-search-block-form">
  <div class="form-item">
    <label for="edit-search-bar">Search bar
    </label>
    <input placeholder="Search by game name" type="text" id="edit-search-bar" name="search_bar" value="" size="60" maxlength="128" class="form-text">
    <div id="close-search-box" style="display: none;">X</div>
  </div>
  <div class="search-results-container" style="display: none;"></div>
</div>
    </div>
  </div>
</nav></header>
    <div class="content-column-wrapper clearfix">
        
<div id="block-adstop-otherpage-728x90" class="block block-cmatgame-core block-adstop-otherpage-728x90">
  
    
      <div class="view-content">
      <div class="item-list"><ol><li class="first last"><div class="panel-pane pane-block pane-cmatgame-advertisement-cm-g-otherpages-728-90"><div class="ad-wrapper"><!-- 728 x 90 ATF Desktop --><div id="leaderboard-atf"></div></div></div></li></ol></div>
    </div>
  </div>


      <div class="content-layout">
        <main class="main-column" role="main">
          <section class="section">
            <div class="inside">
                                
<div id="block-adsleft-otherpage-160x600" class="block block-cmatgame-core block-adsleft-otherpage-160x600">
  
    
      <div class="view-content">
      
    </div>
  </div>


                            <div class="panel-pane pane-page-content">
                <div class="pane-content">
                  <div class="global-wrapper-content">
                    <a id="main-content" tabindex="-1"></a>
                      <div data-drupal-messages-fallback class="hidden"></div>

<div id="block-cmatgame-breadcrumbs" class="block block-system block-system-breadcrumb-block">
  
    
      <div class="view-content">
      
    </div>
  </div>

<div id="block-cmatgame-page-title" class="block block-core block-page-title-block">
  
    
      <div class="view-content">
      <div class="cmatgame-title">
  
      <h1 class="pane-title"><span>Idle Breakout</span>
      

<div id='thumbsup'>
  <span id='thumbsuplike_message'></span>
  <span class='thumbsupmessage'></span>
  <div class="like-container-entity-node" id="like-container-12640">
    <div class="like inline float-left">
      <input type='hidden' id='thumbsvote' value="false"/>
      <a href="javascript:;" nodeid="12640" class="enable entity-node"><img src="/modules/custom/cmatgame_core/images/thumbs_up_white.png" alt="Like" title="Like" class="entity-node"></a>
    </div>
  </div>
  <div class="dislike-container-entity-node" id="dislike-container-12640">
    <div class="dislike inline float-left">
      <input type='hidden' id='thumbsvote' value="false"/>
      <a href="javascript:;" nodeid="12640" class="enable entity-node"><img src="/modules/custom/cmatgame_core/images/thumbs_down_white.png" alt="Dislike" title="Dislike" class="entity-node"></a>
    </div>
  </div>
  <input type="hidden" id="gamerating" name="gamerating" value=""/>
  <input type="hidden" id="percentlike_vote" name="percentlike_vote" value="yes"/>
</div>
</h1>
    
</div>

    </div>
  </div>

<div id="block-carouselingamedetailpage" class="block block-cmatgame-core block-gamedetailcarousel">
  
    
      <div class="view-content">
      <div class="pane-game-details-carousel-game-detail"><div class='view-display-id-carousel_game_detail'><div class='view-header'><p>You'll Also Like...</p></div><div class='view-content'><div><div class='bx-wrapper jcarousel-wrapper'><div class='jcarousel'><ul><li class="bxslider-views-slideshow-main-frame-row"><div class="game-item"><div class="game-link-wrapper"><a href="/0-three-goblets"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Three Goblets Game" title="Three Goblets" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/three-goblets-game-logo.png?itok=DHdP7_mq" class="lazyload" typeof="foaf:Image" />

</div><h5 class="game-title"><span class="overlay"></span><span class="title-on-overlay">Three Goblets</span></h5></a></div></div></li><li class="bxslider-views-slideshow-main-frame-row"><div class="game-item"><div class="game-link-wrapper"><a href="/0-idle-dice"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Idle Dice Game" title="Idle Dice" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/idle-dice-game-logo.png?itok=iqbMD_SA" class="lazyload" typeof="foaf:Image" />

</div><h5 class="game-title"><span class="overlay"></span><span class="title-on-overlay">Idle Dice</span></h5></a></div></div></li><li class="bxslider-views-slideshow-main-frame-row"><div class="game-item"><div class="game-link-wrapper"><a href="/0-clicker-heroes"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Clicker Heroes Game" title="Clicker Heroes" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/clicker-heroes-game-logo.png?itok=B0r7I2gs" class="lazyload" typeof="foaf:Image" />

</div><h5 class="game-title"><span class="overlay"></span><span class="title-on-overlay">Clicker Heroes</span></h5></a></div></div></li><li class="bxslider-views-slideshow-main-frame-row"><div class="game-item"><div class="game-link-wrapper"><a href="/0-learn-to-fly-idle"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Learn to Fly Idle Game" title="Learn to Fly Idle" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/learn-to-fly-idle-game-logo.png?itok=UCwgkQ11" class="lazyload" typeof="foaf:Image" />

</div><h5 class="game-title"><span class="overlay"></span><span class="title-on-overlay">Learn to Fly Idle</span></h5></a></div></div></li></ul></div><div class="bx-controls-direction1"><a href="#" class="jcarousel-control-prev">&lsaquo;</a><a href="#" class="jcarousel-control-next">&rsaquo;</a></div></div></div></div></div></div>
    </div>
  </div>

<div id="block-cmatgame-cmatgame-system-main" class="block block-system block-system-main-block">
  
    
      <div class="view-content">
      
<div class="btn-container">
  <a href="/playlists/0-idle-breakout" class="btn btn-primary btn-md mb-2 playlist-count">This Game is in Playlists</a>
</div>

<div id="block-system-main" class="mt-3">
    <script>
    (function ($, Drupal) {
      $(document).ready(function () {
        var gamePlaylistCount = drupalSettings.cmatgame.gamePlaylistCount;
        if (gamePlaylistCount >0) {
          var playlistMessage = "";
          if (gamePlaylistCount >0 && gamePlaylistCount <= 9) {
              playlistMessage = "VIEW PLAYLISTS WITH THIS GAME";
            } else if(gamePlaylistCount >= 10 && gamePlaylistCount < 100) {
            gamePlaylistCount = parseInt(gamePlaylistCount / 10) * 10;
            playlistMessage = "THIS GAME IS IN " + gamePlaylistCount + "+ PLAYLISTS";
          } else if (gamePlaylistCount >= 100 && gamePlaylistCount < 9999) {
            gamePlaylistCount = parseInt(gamePlaylistCount / 100) * 100;
            playlistMessage = "THIS GAME IS IN " + gamePlaylistCount + "+ PLAYLISTS";
          } else {
            playlistMessage = "THIS GAME IS IN 9999+ PLAYLISTS";
          } $(".playlist-count").html(playlistMessage);
          $(".playlist-count").prependTo('.block-gamedetailcarousel');
          $(".playlist-count").show();
        }
      });
    })(jQuery, Drupal);
  </script>


  <article data-history-node-id="12640" role="article" about="/0-idle-breakout" class="node node-game node--view-mode-full clearfix game-w-summary game-field-wrapper">

        <header>
      
            
    </header>

    <script>
      if (typeof signupPromoTop !== 'undefined' && signupPromoTop !== '') {
        signupContainerTop = '<div class="signup-container-top"><a href="/subscribe/2efa4bc4" onclick="preroll_signup_top_handler();">' + signupPromoTop + '</a></div>';
      } else {
        signupPromoTop = '';
        signupContainerTop = '<div class="signup-container-top"><a href="/subscribe/2efa4bc4" onclick="preroll_signup_top_handler();">' + signupPromoTop + '</a></div>';
      }
      if (typeof signupPromoBottom !== 'undefined' && signupPromoBottom !== '') {
        signupContainerBottom = '<div class="signup-container-bottom"><a href="/subscribe/2efa4bc4" onclick="preroll_signup_bottom_handler();"> ' + signupPromoBottom + '</a></div>';
      } else {
        signupPromoBottom = '';
        signupContainerBottom = '<div class="signup-container-bottom"><a href="/subscribe/2efa4bc4" onclick="preroll_signup_bottom_handler();"> ' + signupPromoBottom + '</a></div>';
      }
      function preroll_signup_top_handler() {
        trackEvent('Preroll Signup Clicked', 'Preroll Signup Top', document.title);
      }
      function preroll_signup_bottom_handler() {
        trackEvent('Preroll Signup Clicked', 'Preroll Signup Bottom', document.title);
      }
    </script>
    <div class="node__content clearfix field-item">
		<div id="no-flash-overlay" style="display:none;">
        <a href="http://www.adobe.com/go/getflashplayer" target="_blank"><img src="/themes/custom/cmatgame/images/enable-flash-chrome.png" alt="click to enable flash"/></a>

        </div>
		<div id="does-not-support-ie" style="display:none;">       
        </div>
		 
         <div id="big-screen-container" class="big-screen-container-class"  style="display:none;">
        <div class="big-screen-head row">
            <div class="bs-head-logo col-md-2"><img src="/themes/custom/coolmath/assets/images/full-screen/cool-math-logo.png"></div>
            <div class="bs-head-txt col-md-9">Premium Gaming Without Distractions</div>
            <div class=" col-md-1"><div class="bs-close-button"><a  href="#" class="bs-close-btn" onclick="bigscreen_overlay_promo_close_handler(); return false;">X</a></div></div>
        </div>
        <div class="mid-big-section-head ">
          <div class="row">
            <div class="col-md-12"><h1>Get Premium Big Screen Mode</h1></div>
            <div class="col-md-12"><h2>Unlimited Big Screen Gaming & More!</h2></div>
          </div>
          <div class="img-container-big-screen row">
              <div class="image-bs-sample col-md-5"> <h2>From This </h2><img src="/themes/custom/coolmath/assets/images/full-screen/BigScreen-small.png"> </div>
              <div class="image-bs-sample col-md-7"> <h2> To this </h2> <img src="/themes/custom/coolmath/assets/images/full-screen/bigscreen-big.png"> </div>
          </div>
          <div>
              <div  class="bs-footer-link">
                <a href="/premium-access/6ea95de6" onclick="bigscreen_overlay_promo_signup_handler(); return false;"><img src="/themes/custom/coolmath/assets/images/full-screen/get-premium-btn.png"></a>
              </div>
              <div class="bs-learn-more"><a href="/premium-benefits" onclick="bigscreen_overlay_promo_more_handler(); return false;" class="bs-lrn-more">Learn More</a></div>
              <div class="bs-no-thks"><a href="" class="bs-lnk-lrn-more" onclick="bigscreen_overlay_promo_close_handler(); return false;">No, Thanks. I just want to play games right now.</a> </div>
          </div>
      </div>
      </div>
        <div id="id-adfree-marketing-campaign" class="adfree-marketing-campaign"  style="display:none;">
        <div class="big-screen-head row">
            <div class="bs-head-logo col-md-2"><img src="/themes/custom/coolmath/assets/images/full-screen/cool-math-logo.png"></div>
            <div class="bs-head-txt col-md-8">Get Premium Distraction Free Gaming!</div>
            <div class="col-md-2">
              <div class="bs-close-button"><a  href="#" class="bs-close-btn" onclick="adfree_marketing_overlay_promo_close_handler(); return false;">X</a></div>
            </div>
        </div>
        <div class="mid-big-section-head  adfree-mid-section-marketing-campaign">
          <div class="mkt-container-co row">
            <div class="mkt-container1 col-md-5"><img src="/themes/custom/coolmath/assets/images/full-screen/ad-free-icon-up.png"></div>
            <div class="ad-free-txt  col-md-5"><span class="sup-bold">AD-FREE:</span> The best gaming experience!</div>
          </div>
          <div class="img-container-big-screen row">
              <div class="" style="padding-left:10px;">
                <div class="image-bs-sample"> <img src="/themes/custom/coolmath/assets/images/full-screen/no-waiting-up.png"> </div>
                <div class="no-waiting-txt"><div class="sup-bold-2">No Waiting:</div> Skip Immediately to the Game</div>
              </div>
              <div class="" style="padding-left:10px;">
                <div class="image-bs-sample"> <img src="/themes/custom/coolmath/assets/images/full-screen/reduce-leg-up.png"> </div>
                <div class="no-waiting-txt"><div class="sup-bold-2">Reduced Lag:</div> Faster, Cleaner Gaming</div>
              </div>
          </div>
          <div class="better-focus-container ">
              <div class="image-better-focus"> <img src="/themes/custom/coolmath/assets/images/full-screen/better-focus-up.png"> </div>
              <div class="no-waiting-txt  "><div class="sup-bold-2">Better Focus:</div>Stay Game-Concentrated</div>
              <div class="all-excl-txt">And More Exclusive features for Premium Members!</div> 
          </div>          
          <div class="marketing-cmpn-footer">
              <div  class="bs-footer-link">
                <a href="/premium-access/b2df5a33" target="_blank" onclick="adfree_marketing_overlay_promo_signup_handler(); return false;"><img src="/themes/custom/coolmath/assets/images/full-screen/get-premium-btn.png"></a>
              </div>
              <div class="bs-learn-more"><a href="/premium-benefits"  target="_blank"  onclick="adfree_marketing_overlay_promo_more_handler(); return false;" class="bs-lrn-more">Learn More</a></div>
              <div class="bs-no-thks"><a href="" class="bs-lnk-lrn-more" onclick="adfree_marketing_overlay_promo_close_handler(); return false;">No, Thanks. I just want to play games right now.</a> </div>
          </div>
        </div>
      </div>
	    <div id="playlist-marketing-container-id"></div>
                    <div class="field-game" id="swfgamewrapper">
  	    	<iframe1 class="square" width="800px" height="600px" src="https://www.coolmathgames.com/0-idle-breakout/play" frameborder="0" id="html5game" scrolling="no" sandbox="allow-scripts allow-same-origin"></iframe1>
      </div>

              
            
      <script type="text/javascript">

  var browser = (function () {
    var test = function (regexp) {
      return regexp.test(window.navigator.userAgent)
    }
    switch (true) {
      case test(/edg/i):
        return "Microsoft Edge";
      case test(/trident/i):
        return "Microsoft Internet Explorer";
      case test(/firefox|fxios/i):
        return "Mozilla Firefox";
      case test(/opr\//i):
        return "Opera";
      case test(/ucbrowser/i):
        return "UC Browser";
      case test(/samsungbrowser/i):
        return "Samsung Browser";
      case test(/chrome|chromium|crios/i):
        return "Google Chrome";
      case test(/safari/i):
        return "Apple Safari";
      default:
        return "Other";
    }
  })();


  // user profile related variables
  gameId = 12640;
  is_level_based = 0;
  level_offset = 0;
  xp_per_level = 10;
  doesnotie = 0;

  var userprofile_level_xp = "100,200,250,300,350,400,450,500,550,625,700,775,850,925,1000,1075,1150,1225,1300,1375,1450,1525,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000,3100,3200,3300,3400,3500,3600,3700,3800,3900,4000,4100,4200,4300,4400,4500,4600,4700,4800,4900,5000,5100,5200,5300,5400,5500,5600,5700,5800,5900,6000,6100,6200,6300,6400,6500,6600,6700,6800,6900,7000,7100,7200,7300,7400,7500,7600,7700,7800,7900,8000,8100,8200,8300,8400,8500,8600,8700,8800,8900,9000,9100,9200,10000";
  userprofile_level_xpData = userprofile_level_xp.split(",");
  incrementedTotalPlays = false;
  lastKeyBoardorMouseActivityTime = Date.now();
  workerstatusvar = "notstartedinit";
  supportCMGDefault = false;//disable a/b test
  supportCMGABTest = false;
  supportCMGABTestImage1 = false;
  supportCMGABTestImage2 = false;
  supportCMGABTestImage3 = false;

  //define all the marketing promo values to false if they are not defined before
  if(typeof watchAdtoUnlockGame == "undefined") {
    watchAdtoUnlockGame = false;
  }
  if(typeof displayAdblockOverlay == "undefined") {
    displayAdblockOverlay = false;
  }
  if(typeof supportCMG == "undefined") {
    supportCMG = false;
  }
  if(typeof premiumAvatarGame == "undefined") {
    premiumAvatarGame = false;
  }

  gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || 0);
    
  

    cmg_stop_truex_promo = "";
  truex_overlay_preroll_ad_display = false;
	 // Big-screen promo games clss-2990
  bs_promo_pages    = /(0-(2048|awesome-planes|awesome-tanks-2|battlecoast|snake|big-ice-tower-tiny-square|big-tower-tiny-square|bloons-tower-defense-3|bob-the-robber|burrito-bison|cannon-basketball-4|choppy-orc|circloo|circloo-2|dolphin-olympics|dolphin-olympics-2|duck-life|duck-life-2-world-champion|duck-life-3-evolution|duck-life-4|duck-life-treasure-hunt|emperors-on-ice|idle-breakout|just-one-boss|learn-to-fly|learn-to-fly-2|learn-to-fly-3|learn-to-fly-idle|mainlands-wars|overlords-new-mansion|papas-freezeria|parking-fury-2|pre-civilization-bronze-age|raft-wars|raft-wars-2|retro-ping-pong|run-3|start-powerless|stickman-swing|the-sun-for-the-vampire|the-sun-for-the-vampire-2|the-sun-for-the-vampire-3|table-tanks|tail-of-the-dragon|the-final-earth|the-final-earth-2|tic-tac-toe|tower-of-destiny|toy-defense|truck-loader-4|wiz|wonderputt|worlds-hardest-game|worlds-hardest-game-2|worlds-hardest-game-3|fireboy-watergirl-5-elements|8-ball-pool|archery-world-tour|awesome-tanks|mainlands-wars|big-tower-tiny-square|handulum|raft-wars|run-3|the-sun-for-the-vampire|tower-of-destiny|wonderputt|papas-freezeria|raft-wars))/;
   // ad free marketing pages clss-3014
  adfreeMktPages    = /(0-(4-in-a-row|60-second-burger-run|apple-worm|arcade-golf-neon|basketball-master-2|black-and-white|bloxorz|bob-the-robber-to-go|candy-jump|cannon-basketball-2|cannon-basketball-3|chef-slash|chrome|color-pipes|crazy-eights|crazy-taxi-m122|cube-flip|cubeform|diggy|divide|emerald-and-amber|factory-balls-forever|get-to-the-other-side|gravity-control|hefty-shaman|idle-dice|interstate-drifter-1999|jellybots|jumpless-world|jumpnull|kirigami|lemonade-stand|loop-path|mow-it|ovo|papa-louie-2-when-burgers-attack|papa-louie-3-when-sundaes-attack|parking-fury-3|parkingmania|parking-mania-2|push-your-luck|puzzle-ball|rabbit-samurai|rabbit-samurai|red-ball-4|roller-baller|stranded-isle|sudoku|super-ordinary-joe|there-is-no-game|word-search|crazy-taxi-m12))/;
   // avatarMktPages
   // CmgDefault not having games clss-3020
  cmgDefaultGameUrl = /(0-(4-in-a-row|60-second-burger-run|apple-worm|arcade-golf-neon|basketball-master-2|black-and-white|bloxorz|bob-the-robber-to-go|candy-jump|cannon-basketball|cannon-basketball-2|cannon-basketball-3|chef-slash|chrome|color-pipes|crazy-eights|crazy-taxi-m12|cube-flip|cubeform|diggy|divide|emerald-and-amber|factory-balls-forever|get-to-the-other-side|gravity-control|hefty-shaman|idle-dice|interstate-drifter-1999|jellybots|jumpless-world|jumpnull|kirigami|lemonade-stand|loop-path|mow-it|ovo|papa-louie-2-when-burgers-attack|papa-louie-3-when-sundaes-attack|parking-fury|parking-fury-3|parkingmania|parking-mania-2|push-your-luck|puzzle-ball|rabbit-samurai|red-ball-4|roller-baller|stranded-isle|sudoku|super-ordinary-joe|there-is-no-game|word-search|abandoned-2-the-forest|abandoned|axiel|bounce-floor|crossy-cat|cupcake-monster|encase|factory-balls|factory-balls-2|factory-balls-3|factory-balls-4|into-space|into-space-2|jelly-escape|marble-trap|mini-golf-adventures|mini-metro-london|off-the-line|pathfinder|red|red-ball-4-volume-2|red-ball-4-volume-3|slime-laboratory|slime-laboratory-2|stranded-isle|solitaire|spot-the-difference|the-ranger-with-the-magic-bow|three-goblets|zombie-launcher|wipo|super-rhino-turtle|round-runner|space-is-key|space-is-key-2|space-is-key-ultimate-challenge|zombie-launcher-2|2048|8-ball-pool|archery-world-tour|awesome-planes|awesome-tanks|awesome-tanks-2|basket-and-ball|battlecoast|big-ice-tower-tiny-square|big-tower-tiny-square|block-the-pig|bloons-tower-defense-3|bob-the-robber|burrito-bison|cannon-basketball-4|catch-the-candy|catch-the-candy-halloween|catch-the-candy-mech|catch-the-candy-xmas|checkers|chess|choppy-orc|circloo|circloo-2|clicker-heroes|copter-royale|darts|dolphin-olympics|dolphin-olympics-2|duck-life|duck-life-2-world-champion|duck-life-3-evolution|duck-life-4|duck-life-treasure-hunt|emperors-on-ice|fireboy-and-water-girl-in-the-forest-temple|fireboy-watergirl-2-light-temple|fireboy-watergirl-3-ice-temple|fireboy-watergirl-4-crystal-temple|fireboy-watergirl-5-elements|handulum|hangman|idle-breakout|iq-ball|jacksmith|jelly-truck|johnny-upgrade|just-one-boss|learn-to-fly|learn-to-fly-2|learn-to-fly-3|learn-to-fly-idle|mainlands-wars|moto-x3m|moto-x3m-pool-party|moto-x3m-spooky-land|overlords-new-mansion|papas-bakeria|papas-burgeria|papas-cheeseria|papas-cupcakeria|papas-donuteria|papas-freezeria|papas-hot-doggeria|papas-pancakeria|papas-pastaria|papas-pizzeria|papas-scooperia|papas-sushiria|papas-taco-mia|papas-wingeria|parking-fury-2|poptropica|powerline-io|pre-civilization-bronze-age|raft-wars|raft-wars-2|retro-ping-pong|run|run-2|run-3|snake|start-powerless|stickman-swing|sticky-ninja-academy|sticky-ninja-missions|the-sun-for-the-vampire|the-sun-for-the-vampire-2|the-sun-for-the-vampire-3|table-tanks|tail-of-the-dragon|tarzan-ball|the-final-earth|the-final-earth-2|tic-tac-toe|tower-of-destiny|toy-defense|truck-loader-4|wiz|wonderputt|worlds-hardest-game|worlds-hardest-game-2|worlds-hardest-game-3|space-is-key-christmas|defly-io))/;
   // premiumAvtar not having games clss-3021
  premiumAvatarMktPages = /(0-(basket-and-ball|block-the-pig|catch-the-candy|catch-the-candy-halloween|catch-the-candy-mech|catch-the-candy-xmas|clicker-heroes|copter-royale|defly-io|fireboy-and-water-girl-in-the-forest-temple|fireboy-watergirl-2-light-temple|fireboy-watergirl-3-ice-temple|fireboy-watergirl-4-crystal-temple|hangman|iq-ball|jacksmith|jelly-truck|johnny-upgrade|moto-x3m-winter|moto-x3m-spooky-land|moto-x3m-pool-party|redline-pong|poptropica|powerline-io|run|run-2|sticky-ninja-academy|sticky-ninja-missions|tarzan-ball|darts|papas-burgeria|papas-bakeria|papas-cheeseria|papas-cupcakeria|papas-donuteria|papas-hot-doggeria|papas-pancakeria|papas-pastaria|papas-pizzeria|papas-scooperia|papas-sushiria|papas-taco-mia|papas-wingeria))/;
  premiumAvatarGame = false;//disabling to fix timer count down issue
  
   // playlist marketing promo games clss-3007
  playlistMktPages = /(0-(abandoned-2-the-forest|abandoned|axiel|bounce-floor|crossy-cat|cupcake-monster|encase|factory-balls|factory-balls-2|factory-balls-3|factory-balls-4|into-space|into-space-2|jelly-escape|marble-trap|mini-golf-adventures|mini-metro-london|off-the-line|pathfinder|red|red-ball-4-volume-2|red-ball-4-volume-3|slime-laboratory|slime-laboratory-2|stranded-isle|solitaire|spot-the-difference|the-ranger-with-the-magic-bow|three-goblets|zombie-launcher|wipo|super-rhino-turtle|round-runner|space-is-key|space-is-key-2|space-is-key-ultimate-challenge|zombie-launcher-2))/;
  
  
  function doesnotIEMessage() {
    jQuery('.field-game').css('display', 'none');
    jQuery('.no-flash').css('display', 'none');
    jQuery('#afg_container').css('display', 'none').html('<div></div>');
    jQuery('#does-not-support-ie').show();
    jQuery('#afg_preloader').css('display', 'none').html('<div></div>');;
    jQuery('#does-not-support-ie').html('<img src="/themes/custom/cmatgame/images/does-not-support-ie.png" alt="does not support ie"/> ');
    jQuery('.load-wrap').hide();
    jQuery('#continue-container').hide();
    jQuery('#afg_preloader').hide();
  }

  function getGameName() {
    var url = window.location.href;
    var lastPart = url.split("/").pop();
    return lastPart;
  }

  function setIframeHeight(iframe) {
    if (iframe) {
    /*
		var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;
		if (iframeWin.document.body) {
			iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;
		}*/
      var gamename = getGameName();
      if (gamename == "0-chess") {
        iframe.height = "620px";
      }
    }
  };

  window.onload = function () {
    setIframeHeight(document.getElementById('html5game'));
  };
  if (isUserValidFreeUserOrSubscriber()) {
    var userprofileData = JSON.parse(localStorage.getItem("userprofile"));
    var levelofcompletedgame = 1;
    for (var i = 0; i < userprofileData.mygameslist.length; i++) {
      if (userprofileData.mygameslist[i].id == gameId) {
        var levelbasedCompletedStatus = userprofileData.mygameslist[i].timebasedcompletedSt;
        var levelofcompletedgame = userprofileData.mygameslist[i].level;
      }
    }
  }
  
 

  /** For big screen promo with list of games to appear
  */
  function checkBigScreenPromoURL(){
    bigScreenPromoGame = false;
    if(bs_promo_pages.test(location.pathname)) {
      bigScreenPromoGame = true;
      jQuery(document).ready(function() {
        jQuery(".pane-bean-new-go-ad-free").html('<a class="bigscreenanchor" onclick="bigscreen_overlay_promo_signup_handler(\'Get big screen mode - header button clicked\'); return false;" href="/premium-access/6ea95de6">Go Big Screen!</a>');
        jQuery('#right-rail-big-screen-promo').show();
      });
    }
  }
  checkBigScreenPromoURL();

  /**
  ** check for marketing game promo for game page. check for specific games to make this popover appear.
  */
  function checkAdfreeMktCmpgnURL(){
    AdfreeMktCmpGame = false;
    if( (typeof adfreeMktPages != 'undefined' && adfreeMktPages.test(location.pathname) ) || (location.pathname == "/0-cannon-basketball") || (location.pathname == "/0-parking-fury")) {
      AdfreeMktCmpGame = true;
      jQuery(document).ready(function() {
        jQuery(".pane-bean-new-go-ad-free").html('<a class="adfree-marketing-logo" onclick="adfree_marketing_overlay_promo_signup_handler(\'Get Adfree Marketing screen mode - header button clicked\'); return false;" href="/premium-access/b2df5a33">Go Big Screen!</a>');
        jQuery('#right-rail-adfree-marketing-promo').show();
      });
    }
  }
  checkAdfreeMktCmpgnURL();
  
  /**
  ** check for playlist marketing game promo for game page. check for specific games to make this popover appear.
  */
  function checkPlaylistMktCmpgnURL(){
    playListMktCmpGame = false;
    if(playlistMktPages.test(location.pathname)  ) {
      playListMktCmpGame = true;
      jQuery(document).ready(function() {
        jQuery(".pane-bean-new-go-ad-free").html('<a class="playlist-marketing-logo" onclick="playlist_marketing_overlay_promo_signup_handler(\'Get Playlist Marketing screen mode - header button clicked\'); return false;" href="/premium-access/b2df5a33">Go Big Screen!</a>');
        jQuery('.playlist-right-side-promo').show();
      });
    }
  }
  checkPlaylistMktCmpgnURL();


  function checkPremiumAvatarURL(){
    premiumAvatarGame = false;
    if(typeof premiumAvatarMktPages != 'undefined' && premiumAvatarMktPages.test(location.pathname) || (location.pathname == "/0-moto-x3m-winter") || ( location.pathname  == '/0-redline-pong')) {
      if (gamesPlayed % 3 === 2) {
        schoolHours = false;//display all the time
        premiumAvatarGame = true;
      }
      //setting the default premiumAvatarGameABTest
          if( getCookie('cmg_fx') !== null && getCookie('cmg_sx') == null){
            var planToSubscription = '67361110';
          }else{
            var planToSubscription = '553bdf22';
          }
          //logged in free user
          jQuery(document).ready(function() {
            jQuery(".pane-bean-new-go-ad-free").html('<a class="premium-avatar-marketing-logo" onclick="premium_avatar_overlay_promo_signup_handler(\'Premium Avatar screen mode - header button clicked\'); return false;" href="/premium-access/'+planToSubscription+'">Go Big Screen!</a>');
            jQuery('.premium-avatar-right-side-promo').show();
          });
          var gamePageBarPromo = 'GET THE AVATAR: GO PREMIUM';
          gamePageBarPromoActionText = 'Get Premium ';
          var pathpromobarsubscriptionform = '/subscribe/'+ planToSubscription;
          jQuery('.gamepage-signup-promo').hide();
          jQuery('#block-cmatgame-cmatgame-system-main').append('<div class="premium-avatar-promo marketing-gamepage-signup-promo"><h2>' + gamePageBarPromo + '</h2> <div class="link-in-title-block-promo"><a href="/subscribe/'+planToSubscription+'" id="gamepage_bs_signup_promo_handler" onclick="premium_avatar_overlay_promo_signup_handler(\'Premium Avatar screen mode - promo bar clicked\'); return false;">' + gamePageBarPromoActionText + '</a></div></div>');
          
    }
  }
   
  function checkPlayedGames(){
    //this is for supportCMG A/B Test
    gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || 0);
    sessionGamesPlayed = parseInt(sessionStorage.getItem('sessionGamesPlayed') || 0);
    localStorage.setItem('gamesPlayed', ++gamesPlayed)
    sessionStorage.setItem('sessionGamesPlayed', ++sessionGamesPlayed);
    checkPremiumAvatarURL();
  }
  
  
  /**
  ** For CMG default screen promo with list of games to appear
  */
  function checkCMGDefaultExceptionURL(){
    supportCMG = false;
    if(!cmgDefaultGameUrl.test(location.pathname) && (typeof gamesPlayed != "undefined" && gamesPlayed % 3 === 2)) {
      supportCMG = true;
      schoolHours = false;//display all the time

      if( getCookie('cmg_fx') !== null && getCookie('cmg_sx') == null){
        var planToSubscription = 'd61242ac';
      }else{
        var planToSubscription = '0735a1f2';
      }//logged in free user
      jQuery(document).ready(function() {
        jQuery(".pane-bean-new-go-ad-free").html('<a class="cmgDefaultException-logo" onclick="cmgDefault_overlay_promo_signup_handler(\'Get CMGDefault screen mode - header button clicked\'); return false;" href="/premium-access/'+planToSubscription+'">Go Big Screen!</a>');
        jQuery('.cmgdefault-right-side-promo').show();
      });
        var gamePageBarPromo = 'GO PREMIUM: THE BEST GAMING EXPERIENCE';
        gamePageBarPromoActionText = 'Get Premium ';
        var pathpromobarsubscriptionform = '/subscribe/'+ planToSubscription;
        jQuery('.gamepage-signup-promo').hide();
        jQuery('#block-cmatgame-cmatgame-system-main').append('<div class="marketing-gamepage-signup-promo"><h2>' + gamePageBarPromo + '</h2> <div class="link-in-title-block-promo"><a href="/subscribe/'+planToSubscription+'" id="gamepage_bs_signup_promo_handler" onclick="cmgDefault_overlay_promo_signup_handler(\'Get CMGDefault screen mode - promo bar clicked\'); return false;">' + gamePageBarPromoActionText + '</a></div></div>');
    }
  }

  
  checkPlayedGames();
  settimebased();
  checkCMGDefaultExceptionURL();
   
 
    if(isUserValidFreeUserOrSubscriber()) {
      var userprofileData = JSON.parse(localStorage.getItem("userprofile"));
      var levelofcompletedgame = 1;
       for (var i = 0; i < userprofileData.mygameslist.length; i++) {
          if(userprofileData.mygameslist[i].id == gameId) {
            var levelbasedCompletedStatus = userprofileData.mygameslist[i].timebasedcompletedSt;
            var levelofcompletedgame = userprofileData.mygameslist[i].level;
          }

       }
    }

 var workerstatusvar = "no";
 var count = 0;
 var myInterval;
 // Active

 function chkIdleOnpage() {
   var userActivityTime = Date.now();
    // check if user activity is not there more than 55 min 60000*55 = 3300000
   if(userActivityTime - lastKeyBoardorMouseActivityTime > 3300000) {
     if(typeof(w) != "undefined") {
       workerstatusvar = "terminated";
       w.terminate();
       w = undefined;
     }
   } else {
     //May be keyboard is active start new worker
     settimebased();
   }
 }
 // Inactive
 if(!is_level_based) {
   // check idle time in every 5 min 60000 * 5 = 300000
   idleOnPageCheckTimer = setInterval(function () { chkIdleOnpage() }, 300000);
 }
 function settimebased() {
   if(!is_level_based) {
     jQuery(document).ready(function() {
       if(isUserValidFreeUserOrSubscriber()) {
         window.addEventListener("beforeunload", function (e) {
           saveUserProgress();
         });
         if(typeof(Worker) !== "undefined") {
           if(typeof(w) == "undefined") {

             w = new Worker("/modules/custom/cmatgame_userprofile/js/userprogress_workers.js");
             w.onmessage = function(event) {
               var userActivityTime = Date.now();
               //save userprofile object back to localstorage
               //if(userActivityTime - lastKeyBoardorMouseActivityTime <= 60000) {
               userprofile = event.data;
               localStorage.setItem("userprofile",JSON.stringify(userprofile));

               //display game progressbar on game pages
               if(typeof gameId != "undefined") {
                 display_game_progressbar(gameId);
               }
               //display user progressbar
               display_user_profile_progressbar();
              //}
             };

             var userprofile = localStorage.getItem("userprofile");
             setTimeout(function () {
               var userprofile = localStorage.getItem("userprofile");
               var currentGameData = searchGamesById(gameId);
               if(typeof w != 'undefined') {
                 w.postMessage([gameId,xp_per_level, userprofile, currentGameData, cmatgameSearchGames , userprofile_level_xpData]);
               }
             }, 60000);
             //setInterval(function () { updateMyGamesTimeSpent1(gameId) }, 60000);
           }
         }
       }
     });
   }
 }

 // Stop timer
 function stopTimer() {
   count = 0;

  if(workerstatusvar == "terminated" ){
    settimebased();
    workerstatusvar = "started";
  }
  window.clearInterval(myInterval);
 }



  function checkKeyboardOrMouseActivity() {
    lastKeyBoardorMouseActivityTime = Date.now();
    if (!is_level_based) {
      if (typeof isRemoveAdSwfJWPLayer === "undefined" || !isRemoveAdSwfJWPLayer) { // html 5 game
      } else {
        stopTimer();
      }
    }
  }
  function startTimer() {
     // for flash based game check idle time in every 5 min 60000 * 5 = 300000
    myInterval = window.setInterval(timerHandler, 30000);
  }
  function timerHandler(){
    count++;
    // count of flash based game will  for 55 rounds
    if(count == 55 ){
      workerstatusvar = "terminated";
      if(typeof w !== 'undefined') {
        w.terminate();
        w = undefined;
      }
    }
  }
  document.addEventListener("mousemove", checkKeyboardOrMouseActivity, false);
  document.addEventListener('keydown', checkKeyboardOrMouseActivity, false);

  document.addEventListener("keypress", checkKeyboardOrMouseActivity, false);
  document.addEventListener("touchmove", checkKeyboardOrMouseActivity, false);
  if(!is_level_based) {
    if (typeof isRemoveAdSwfJWPLayer === "undefined" || !isRemoveAdSwfJWPLayer) {
      // html 5 game
      document.addEventListener("visibilitychange", function() {

        if(document.visibilityState == 'hidden') {
          //startTimer();
          if(typeof idleOnPageCheckTimer !== 'undefined') {

            clearInterval(idleOnPageCheckTimer);
          }
          /***  need to remove below workerstatusvar variable. position changed . it should be under if codition
            where worker undefine
          ***/
          //workerstatusvar = "terminated";
          
          if(typeof w !== 'undefined') {
            w.terminate();
            w = undefined;
            workerstatusvar = "terminated";
          }

        } else if(document.visibilityState == 'visible') {
          stopTimer();//starts worker.
        }
      }, false);
    } else {
      // flash game
      window.addEventListener('focus', stopTimer);
      window.addEventListener('blur',  startTimer );
      //Check browser minimize
      document.addEventListener("visibilitychange", function() {

        if(document.visibilityState == 'hidden') {
          startTimer();
        } else if(document.visibilityState == 'visible') {

          stopTimer();
        }
      }, false);

      startTimer();

    }
  } //end of !is_level_based

  function putSharedObjectsInDB(syncData){
    flashStorage = syncData;
    saveUserProgress();
  }
  isRemoveAdSwfJWPLayer = false;
  // Testing Overlay for Watch Ad To Unlock Games
  // var watchAdtoUnlockGame = true;
  // var schoolHours = false;
  // console.log('supportCMG is true');
  window.addEventListener("message", receiveMessage, false);
  function receiveMessage(event) { // console.log("message received2 from " + event.origin + " : " + event.data);
    var valid_domain_msg = false;
    if(/coolmathgames\.com|coolmathgames\.local|coolmathgames/.test(event.origin)) {
      valid_domain_msg = true;
    }
    if (event.data == "continue-without-big-screen" && jQuery('#big-screen-overlay').length && valid_domain_msg) { // close overlay
      if (jQuery('#big-screen-overlay').length) {
        jQuery('#big-screen-overlay').hide();
        if(jQuery('#big-screen-truex-overlay').length) { jQuery('#big-screen-truex-overlay').hide(); }
        cmg_bigscreen_trackevent('closesignup', cmg_bsft);
      }
    } else if (event.data == "continue-with-login-big-screen" && jQuery('#big-screen-overlay').length && valid_domain_msg) {
      //console.log("BIGSCREEN message received2 from " + event.origin + " : " + event.data);
      cmg_bigscreen_trackevent('closesignup2login', cmg_bsft);
      jQuery('#big-screen-overlay').hide();
      if(jQuery('#big-screen-truex-overlay').length) { jQuery('#big-screen-truex-overlay').hide(); }
      window.location = "/login?destination="+window.location.pathname;
    } else if (event.data == "continue-premium-big-screen"  && (jQuery('#big-screen-overlay').length || jQuery('#pr-profile-screen-overlay').length) && valid_domain_msg) {
      //console.log("BIGSCREEN message received2 from " + event.origin + " : " + event.data);
      cmg_bigscreen_trackevent('playgame after signup', cmg_bsft);
      jQuery('#big-screen-overlay').hide();
      jQuery('#pr-profile-screen-overlay').hide();
      if(jQuery('#big-screen-truex-overlay').length) { jQuery('#big-screen-truex-overlay').hide(); }
      window.location.reload();
    } else if (event.data == "big-screen-profile-customize" && (jQuery('#big-screen-overlay').length  || jQuery('#pr-profile-screen-overlay').length) && valid_domain_msg) {
      //console.log("BIGSCREEN message received2 from " + event.origin + " : " + event.data);
      cmg_bigscreen_trackevent('profile customize after signup', cmg_bsft);
      jQuery('#big-screen-overlay').hide();
      jQuery('#pr-profile-screen-overlay').hide();
      if(jQuery('#big-screen-truex-overlay').length) { jQuery('#big-screen-truex-overlay').hide(); }
      if (getCookie('cmg_fx') !== null) {
        window.location = '/profile/' + getCookie('cmg_fx').toLowerCase() + '/edit';
      }
    } else if (event.data == "big-screen-premium-benefits" && jQuery('#big-screen-overlay').length && valid_domain_msg) {
      //console.log("BIGSCREEN message received2 from " + event.origin + " : " + event.data);
      cmg_bigscreen_trackevent('see premium benefits after signup', cmg_bsft);
      jQuery('#big-screen-overlay').hide();
      if(jQuery('#big-screen-truex-overlay').length) { jQuery('#big-screen-truex-overlay').hide(); }
      if (getCookie('cmg_fx') !== null) {
        window.location = '/premium-benefits';
      }
    } else if (event.data == "keypress-from-game") {
      checkKeyboardOrMouseActivity();
    } else if (event.origin === "https://copterroyale.coolmathgames.com" || event.origin === "https://copterroyale2.coolmathgames.com" || event.origin === "https://powerline.coolmathgames.com") {

      var eventObject = JSON.parse(event.data);
      if (eventObject.eventType == "gameEvent") {
        cmgGameEvent(eventObject.key, eventObject.value);
      } else if (eventObject.eventType == "dataEvent") {
        cmgDataEvent(eventObject.key, eventObject.value);
      }
    } else if (event.origin == 'https://www.coolmath-games.com' || event.origin != 'https://d8-dev.coolmathgames.com') {
      if (event.data.eventType == "syncEventPut") {
        syncData = event.data.syncJSON;
        putSharedObjectsInDB(syncData);
      }
      if (event.data.eventType == "syncEventGet") {
        if (typeof flashStorageFromDB != "undefined") { // restoring flash shared objects from DB
          for (var i = 0; i < flashStorageFromDB.length; i++) {
            flashStorageFromDB[i].swfdata = decodeURI(flashStorageFromDB[i].swfdata);
          }
          document.getElementById('swfgame').contentWindow.postMessage({
            'eventType': 'syncEventGet',
            'soData': flashStorageFromDB
          }, '*');
        } else {
          document.getElementById('swfgame').contentWindow.postMessage({
            'eventType': 'gamePlay'
          }, '*');
        }
      }
    } else {
      return;
    }
  }
  // var signupPromoTop = 'Join to Play Ad-Free'; var signupPromoBottom = 'Join to Skip All Ads';
  if (typeof signupPromoTop !== 'undefined' && signupPromoTop !== '') {
    signupContainerTop = '<div class="signup-container-top"><a href="/premium-access/2efa4bc4" id="preroll_signup_top_handler">' + signupPromoTop + '</a></div>';
  } else {
    signupPromoTop = '';
    signupContainerTop = '<div class="signup-container-top"><a href="/premium-access/2efa4bc4" id="preroll_signup_top_handler">' + signupPromoTop + '</a></div>';
  }
  if (typeof signupPromoBottom !== 'undefined' && signupPromoBottom !== '') {
    signupContainerBottom = '<div class="signup-container-bottom"><a href="/premium-access/2efa4bc4" id="preroll_signup_bottom_handler"> ' + signupPromoBottom + '</a></div>';
  } else {
    signupPromoBottom = '';
    signupContainerBottom = '<div class="signup-container-bottom"><a href="/premium-access/2efa4bc4" id="preroll_signup_bottom_handler"> ' + signupPromoBottom + '</a></div>';
  }
  function preroll_signup_top_handler() {
    trackEvent('Preroll Signup Clicked', 'Preroll Signup Top', document.title);
  }
  function preroll_signup_bottom_handler() {
    trackEvent('Preroll Signup Clicked', 'Preroll Signup Bottom', document.title);
  }

  // we will define this varialbe signUpURLABTest in experiments.js
  var cmg_upg_days_limit = 180;
  var user_dst = window.location.pathname;
  user_dst = user_dst.replace("\/", "");
  if (window.location.host !== 'cmatgame.local') {
    if (typeof signUpURL === 'undefined' || signUpURL === '') {
      signUpURL = '/premium-access/ b2df5a33?origin=' + user_dst;
    } else {
      signUpURL = signUpURL + '?origin=' + user_dst;
    }
  } else if (typeof signUpURLABTest === "undefined" || signUpURLABTest === null) {
    signUpURL = 'https://' + window.location.hostname + '/premium-access/ b2df5a33?origin=' + user_dst;
  } else {
    signUpURL = signUpURLABTest;
  }
  function subscription_promo_handler() {
    if (typeof freeTrialUser !== 'undefined' && freeTrialUser) {
      trackEvent('Premium Subscription ' + subscriberLeg, 'Subscription overlay clicked', userPlayedGames);
      trackGoalVirtualPV('/virtual/subscription-overlay-click');
    }
    return;
  }
  function subscriptionSignUpUrl() {
    var user_played_games = '';
    var zeroFreeGamesLeftUsers = localStorage.getItem("zeroFreeGamesLeftUsers");
    if (typeof userPlayedGames !== 'undefined' && userPlayedGames) {
      user_played_games = "upg=" + userPlayedGames;
    } else {
      user_played_games = "upg=0";
    }
    if (zeroFreeGamesLeftUsers !== null && user_played_games !== '') {
      user_played_games = user_played_games + '&zfg=' + zeroFreeGamesLeftUsers;
    } else if (zeroFreeGamesLeftUsers !== null) {
      user_played_games = 'zfg=' + zeroFreeGamesLeftUsers;
    }
    if (typeof signUpURL !== 'undefined' && signUpURL !== null && signUpURL.indexOf('upg') === -1) {
      if (signUpURL.indexOf('?random_true') > -1) {
        signUpURL = signUpURL.replace('?random_true', '');
      }
      if (signUpURL.indexOf('?') > -1) {
        signUpURL = signUpURL + '&' + user_played_games;
      } else {
        signUpURL = signUpURL + '?' + user_played_games;
      }
    }
  }

  function updateMyGamesTimeSpent(gameId) {
    var userActivityTime = Date.now();
    // if(userActivityTime - lastKeyBoardorMouseActivityTime <= 60000) { //user is active on page for last 60 seconds, so we can add this as his XP
    if (currentTimeInterval >= 2) {
      currentTimeInterval = 0;
      if (isUserValidFreeUserOrSubscriber()) { // save MyGames only for subscribers
        saveMyGames(gameId, 0, 1);
        currentTime = userActivityTime;
      }
    } else {
      currentTimeInterval = currentTimeInterval + 1;
      saveUserProgress(); // save user progress every 20 sec
    }
    // }
  }

  function updateMyGamesTimeSpent1(gameId) {
    if(isUserValidFreeUserOrSubscriber()) { //save MyGames only for subscribers
      if(userActivityTime - lastKeyBoardorMouseActivityTime <= 60000) {
        saveMyGames(gameId,0,1);
      }
    }
  }

  function updateMyGamesTimeSpentLevelBase(gameId,level) {
    if(isUserValidFreeUserOrSubscriber()) { //save MyGames only for subscribers

    saveMyGames(gameId,1,level);
    }
  }
    /*
   if(!is_level_based) {
    var objGameNode = {};
    objGameNode[gameId] = "yes";
    localStorage.setItem("runoncestarted", JSON.stringify(objGameNode));
        setInterval(function () { updateMyGamesTimeSpent1(gameId) }, 60000);
      }
   */
    if(is_level_based){
      var userActivityTime = Date.now();
    // for level based game. check if user activity is not there more than 55 min 60000*55 = 3300000
      if(userActivityTime - lastKeyBoardorMouseActivityTime <= 3300000) {
      var objGameNode = {};
      objGameNode[gameId] = "no";
      var localgamestrate = "storagelocal-"+gameId+ "-storagelocal";
      localStorage.setItem("runoncestarted", JSON.stringify(objGameNode));
      localStorage.setItem(localgamestrate, "no");
      updateMyGamesTimeSpentLevelBase(gameId,levelofcompletedgame)
    }
  }



  function removePrerollAndDisplayGame() {
    settimebased();
    // console.log('remove ad swf');
    if (isRemoveAdSwfJWPLayer) { // remove preroll only once

    } else { // record current time to calculate how much time user spent on playing the current game
      currentTime = Date.now();
      currentTimeInterval = 0;
      // call this only for timebased games
      // TODO save game progress
      /*if(!is_level_based) {
        setInterval(function () { updateMyGamesTimeSpent(gameId) }, 20000);
      }
      */


      jQuery("#my-content").css("opacity", "1");
      if (typeof intervalId != "undefined") {
        clearInterval(intervalId);
      }
      jQuery("#afg_container").remove();
      jQuery("#afg_preloader").remove();
      jQuery("#continue-container").remove();
      if (!drupalSettings.cmatgame.swfembed) { // html5 game game width, game height and game type
        game_width = jQuery("#html5game").attr("width");
        game_height = jQuery("#html5game").attr("height");
        game_type = "html5";
        // IE Detection and Version grabbing
        ie = false;
        var html5_game_url = jQuery("#html5game").attr("src");
        var swf_game_url = jQuery("#swfgame").attr("src");

        if (typeof swf_game_url !== 'undefined') {
          if (!checkIfFlashIsEnabled()) { // console.log('flash is undefined');
            flashDetectionMessage();
          }
        }
        if (typeof swf_game_url !== 'undefined' && swf_game_url.indexOf("//") === 0) {
          swf_game_url = window.location.protocol + swf_game_url;
        } else if (typeof swf_game_url !== 'undefined' && swf_game_url.indexOf("//") > 0) {
          swf_game_url = swf_game_url.replace("http:", window.location.protocol);
        }
        if (typeof html5_game_url !== 'undefined' && html5_game_url.indexOf("//") === 0) {
          html5_game_url = window.location.protocol + html5_game_url;
        } else if (typeof html5_game_url !== 'undefined' && html5_game_url.indexOf("//") > 0) {
          html5_game_url = html5_game_url.replace("http:", window.location.protocol);
        }
        if (navigator.appName == "Microsoft Internet Explorer") {
          ie = true;
          var ua = navigator.userAgent;
          var re = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
          if (re.exec(ua) != null) {
            ieVersion = parseInt(RegExp.$1)
          }
        }
        if (ie && ieVersion < 9) {
          nothtml5browser = '<div style="margin-top:20px;color: #f5e61f;line-height:1.1em;font-size: 1.867em;">Hey, you\'re using an older web browser that can\'t play HTML5 games like this one.<br><br>Please switch to another browser or just enjoy a different Coolmath game!</' + 'div><br><p style="font-size:1.6em;color:#0E83D4;font-weight:bold;">&#8226; <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie" target="_new">Get a new Internet Explorer browser from Microsoft</a></p>';
          jQuery("#html5game").replaceWith(nothtml5browser);
          jQuery("#swfgame").replaceWith(nothtml5browser);
        } else {
          sandbox = jQuery("#html5game").attr("sandbox");
          if (sandbox !== undefined) {
            sandbox = ' sandbox=\"' + sandbox + '\"';
          } else {
            sandbox = '';
          }
          newiframe = '<iframe id="html5game" src="' + html5_game_url + '" class="' + jQuery("#html5game").attr("class") + '" width="' + jQuery("#html5game").attr("width") + '" height="' + jQuery("#html5game").attr("height") + '" scrolling="no" marginwidth="0' + '" vspace="0" frameborder="0" hspace="0" marginheight="0"' + sandbox + '></iframe>';
          newswfiframe = '<iframe id="swfgame" src="' + swf_game_url + '" class="' + jQuery("#swfgame").attr("class") + '" width="' + jQuery("#swfgame").attr("width") + '" height="' + jQuery("#swfgame").attr("height") + '" scrolling="no" marginwidth="0" vspac' + 'e="0" frameborder="0" hspace="0" marginheight="0"></iframe>';
          if (typeof isRemoveAdSwfJWPLayer === "undefined" || !isRemoveAdSwfJWPLayer) {
            jQuery("#html5game").replaceWith(newiframe);
            if (checkIfFlashIsEnabled()) {
              jQuery("#swfgame").replaceWith(newswfiframe);
            }
          }
        }
      } else {
        if (!checkIfFlashIsEnabled()) {
          // console.log('flash is undefined');
          /* CLSS-1614 to load html5 as backup - START */
          var html5_game_url = jQuery("#html5game").attr("src");
          if (typeof html5_game_url !== 'undefined') {
            game_width = jQuery("#html5game").attr("width");
            game_height = jQuery("#html5game").attr("height");
            game_type = "html5";
            // IE Detection and Version grabbing
            ie = false;
            if (typeof html5_game_url !== 'undefined' && html5_game_url.indexOf("//") === 0) {
              html5_game_url = window.location.protocol + html5_game_url;
            } else if (typeof html5_game_url !== 'undefined' && html5_game_url.indexOf("//") > 0) {
              html5_game_url = html5_game_url.replace("http:", window.location.protocol);
            }
            if (navigator.appName == "Microsoft Internet Explorer") {
              ie = true;
              var ua = navigator.userAgent;
              var re = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
              if (re.exec(ua) != null) {
                ieVersion = parseInt(RegExp.$1)
              }
            }
            if (ie && ieVersion < 9) {
              nothtml5browser = '<div style="margin-top:20px;color: #f5e61f;line-height:1.1em;font-size: 1.867em;">Hey, you\'re using an older web browser that can\'t play HTML5 games like this one.<br><br>Please switch to another browser or just enjoy a different Coolmath game!</' + 'div><br><p style="font-size:1.6em;color:#0E83D4;font-weight:bold;">&#8226; <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie" target="_new">Get a new Internet Explorer browser from Microsoft</a></p>';
              jQuery("#html5game").replaceWith(nothtml5browser);
            } else {
              sandbox = jQuery("#html5game").attr("sandbox");
              if (sandbox !== undefined) {
                sandbox = ' sandbox=\"' + sandbox + '\"';
              } else {
                sandbox = '';
              }
              newiframe = '<iframe id="html5game" src="' + html5_game_url + '" class="' + jQuery("#html5game").attr("class") + '" width="' + jQuery("#html5game").attr("width") + '" height="' + jQuery("#html5game").attr("height") + '" scrolling="no" marginwidth="0' + '" vspace="0" frameborder="0" hspace="0" marginheight="0"' + sandbox + '></iframe>';
              if (typeof isRemoveAdSwfJWPLayer === "undefined" || !isRemoveAdSwfJWPLayer) {
                jQuery("#html5game").replaceWith(newiframe);
              }
            }
          } else { /* CLSS-1614 to load html5 as backup - END */
            flashDetectionMessage();
          }
        } else { // flash game game width, game height and game type
          game_width = drupalSettings.cmatgame.swfembed.swf.swf_1.width;
          game_height = drupalSettings.cmatgame.swfembed.swf.swf_1.height;
          game_type = "flash";

          if (typeof isRemoveAdSwfJWPLayer === "undefined" || !isRemoveAdSwfJWPLayer) {
            var swf_game_url = jQuery("#swfgame").attr("src");
            if (typeof swf_game_url !== 'undefined' && swf_game_url.indexOf("//") === 0) {
              swf_game_url = window.location.protocol + swf_game_url;
            } else if (typeof swf_game_url !== 'undefined' && swf_game_url.indexOf("//") > 0) {
              swf_game_url = swf_game_url.replace("http:", window.location.protocol);
            }
            newswfiframe = '<iframe id="swfgame" src="' + swf_game_url + '" class="' + jQuery("#swfgame").attr("class") + '" width="' + jQuery("#swfgame").attr("width") + '" height="' + jQuery("#swfgame").attr("height") + '" scrolling="no" marginwidth="0" vspac' + 'e="0" frameborder="0" hspace="0" marginheight="0"></iframe>';
            jQuery("#swfgame").replaceWith(newswfiframe);

            var gameInstructions = document.getElementById('game-instructions');
            // insert fix flash div before game instructions field
            if (typeof gameInstructions !== 'undefined' && gameInstructions !== null && typeof gameInstructions.innerHTML !== 'undefined' && gameInstructions.innerHTML !== null) {
              gameInstructions.innerHTML = '<div class="no-flash">If this flash game doesn\'t work on your computer, go <a href="/fix-flash.html">here</a> for help.</div><br><br>' + gameInstructions.innerHTML;
            }
          }
          isRemoveAdSwfJWPLayer = true;
        }
      }
    }
    $('.game-xp-bar-immerse-button').addClass('enabled');
    jQuery('.btn.btn-primary.btn-sm.requestfullscreen').css('display', 'inline-block');
    display_game_progressbar(gameId);
  }

  function cmatgame_premium_subscription_game_display() {
    var cmatgame_subscriber = getCookie('cmg_sx');
    var validSubscriber = false;
    if (typeof cmatgame_subscriber !== 'undefined' && cmatgame_subscriber !== null) {
      validSubscriber = true;
    }
    if(getCookie("cmg_wl") !== null) {
      validSubscriber = true;
    }
    var cmatgame_free_user = getCookie('cmg_fx');
    var validFreeUser = false;
    if (typeof cmatgame_free_user !== 'undefined' && cmatgame_free_user !== null) {
      validFreeUser = true;
    }

    if (typeof subscribeNowAlienClass === 'undefined' || subscribeNowAlienClass === null || subscribeNowAlienClass === '') {
      // if (drupalSettings.cmatgame.isSubscriptionActive == false) {
      // subscribeNowAlienClass = "subscribe-now-alien-subscribe";
      // } else {
      // subscribeNowAlienClass = "subscribe-now-alien-signup";
      // }
    }
    freeGamesExceeded = true;
    //display Ads to anonymous users the time from 7am to 13pm, display ads to anonymous users  from 13pm to 11:59pm and 00 to 7am only if the user is not from New York city
    //  TODO -->  Need to add day of the week for school hours logic, day < 6 do not display Ads when GDPR cookie is set abd GDPR_All cookie is not set
    //Remove preroll-ads for whitelist users
    if (validSubscriber || getCookie("cmg_wl") !== null) {
      //retrieve user progress
      retrieveUserProgress();
      removePrerollAndDisplayGame();
      jQuery(document).ready(function () {
        $('.game-xp-bar-immerse-button').addClass('enabled');
        jQuery('.btn.btn-primary.btn-sm.requestfullscreen').css('display', 'inline-block');
        display_game_progressbar(gameId);
        immersive_mode_display_controller();
      });

    } else if (getCookie('cmg_schwl') !== null || typeof cmg_no_ads !== 'undefined' || (! validSubscriber && schoolHours || (!schoolHours && !targetStateUser) || (!schoolHours && targetStateUser && getCookie('cmg_active_anonymous_user') !== null))) { // TODO Display Game
      removePrerollAndDisplayGame();
      jQuery(document).ready(function () {
        $('.game-xp-bar-immerse-button').addClass('enabled');
        jQuery('.btn.btn-primary.btn-sm.requestfullscreen').css('display', 'inline-block');
        display_game_progressbar(gameId);
      });

      if (!/0-chess/.test(window.location.pathname)) { // setCookie('cmg_active_anonymous_user', 'active', 30*60*1000);
      }
    } else if (! validSubscriber && !schoolHours && targetStateUser && getCookie('cmg_active_anonymous_user') === null && getCookie('cmg_editor') === null) { // if user comes from google dont show the subscription paywall
      var ref = document.referrer;
      // count number of games played by the user this month
      userPlayedGames = 0;
      var userFreeGameList = [];
      var freeGameNid = 12640;
      if (sessionStorage.getItem("userFreeGameList") !== null) {
        userFreeGameList = JSON.parse(sessionStorage.getItem("userFreeGameList"));
      }
      if ((localStorage.getItem("userPlayedGames") == null || getCookie('cmg_upg') === null) && freeGameLimit !== 0) {
        userPlayedGames = 1;
        localStorage.setItem("userPlayedGames", userPlayedGames);
        // TODO monthly cookie
        setCookie('cmg_upg', 'true', cmg_upg_days_limit * 24 * 60 * 60 * 1000);
        userFreeGameList = [freeGameNid];
        sessionStorage.setItem("userFreeGameList", JSON.stringify(userFreeGameList));
        // TODO Display Game
        removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });

      } else { // userPlayedGames = parseInt(localStorage.getItem("userPlayedGames"+currentMonth+currentYear)); Monthly limit
        if (localStorage.getItem("userPlayedGames") !== null && getCookie('cmg_upg') !== null) {
          userPlayedGames = parseInt(localStorage.getItem("userPlayedGames"));
        } else {
          userPlayedGames = 0;
          setCookie('cmg_upg', 'true', cmg_upg_days_limit * 24 * 60 * 60 * 1000);
        }
        if (freeGameLimit != 0 && userPlayedGames < freeGameLimit && userFreeGameList.indexOf(freeGameNid) === -1) {
          userPlayedGames ++;
          freeGamesExceeded = false;
          if (userFreeGameList.length > 0) {
            userFreeGameList = userFreeGameList.concat(freeGameNid);
          } else {
            userFreeGameList = [freeGameNid];
          }
          localStorage.setItem("userPlayedGames", userPlayedGames);
          sessionStorage.setItem("userFreeGameList", JSON.stringify(userFreeGameList));
        } else {
          freeGamesExceeded = true;
        }
        // console.log("Number of games user has played "+ userPlayedGames );
        var validReferer = false;
        var validGameSession = false;
        if (userFreeGameList.indexOf(freeGameNid) > -1) {
          validGameSession = true;
        }
        if (ref.match("google.com") !== null || ref.match("yahoo.com") !== null || ref.match("bing.com") !== null) {
          validReferer = true;
        }
        subscriptionSignUpUrl();
        if (! validReferer && userPlayedGames >= freeGameLimit && ! validGameSession) {
          // subscription paywall
          // block anonymous users for New York City from 0-7am and 13pm to 11:59pm console.log("Free games limit exceeded and referer is not google");
          clearInterval(intervalId);
          jQuery("#afg_container").remove();
          jQuery(".title-instructions").remove();
          jQuery(".body-instructions").remove();
          var alreadySubscriberText = '<p class="already-subscribed">Already a Subscriber? <a class="learn-more-link" href="/login">Login</a></p>';
          if (getCookie('cmg_l') != null) {
            alreadySubscriberText = '';
          }
          var headLine = '<p class="no-free-games-headline">Please Sign up to keep playing</p>';
          if (getCookie('cmg_l') != null && getCookie('cmg_sx') != null) {
            headLine = '<p class="no-free-games-headline" style="padding-top:46px;">PLEASE SUBSCRIBE NOW TO KEEP PLAYING</p>';
          }
          jQuery(".field-game").html('<div class="subscription-overlay" style="height:360px;width:500px;background:#008aa3;white-space:normal;">' + headLine + '<p class="free-in-schools">The World\'s Best Collection of Games <br> For Logic, Reasoning & Fun.  <a class="' + subscribeNowAlienClass + '" id="game_subscription_promo_handler" href="' + signUpURL + ' ">Subscribe Now</a>' + alreadySubscriberText + '</div>');
          jQuery("#videoplayer").remove();
        } else {
          // console.log("User may have come from google or is within the free game limit "+ (freeGameLimit-userPlayedGames) );
          // TODO Display Game
          removePrerollAndDisplayGame();
          jQuery(document).ready(function () {
            display_game_progressbar(gameId);
          });
        }
      }
    }
  }
  function unlockAllLevels() {
    trackEvent('Unlock All Levels category', 'unlock all levels button clicked', document.title);
    alllevels = '<div id="subscriber-banner"><div class="adobe-analytics-sub-experience levels-unlocked">levels-unlocked</div></div>';
    jQuery("#subscriber-banner").replaceWith(alllevels);
    var cmgorigindomain = /coolmath-games/;
    var cmgtargetdomain = window.location.protocol + 'www.coolmath-games.com';
    if (/edit-stage/.test(window.location.hostname)) {
      cmgtargetdomain = window.location.protocol + 'edit-stage.coolmath-games.com';
    } else if (/d8-dev/.test(window.location.hostname)) {
      cmgtargetdomain = window.location.protocol + 'stage.coolmath-games.com';
    } else if (/cmatgame.local|dev.coolmath.games.com/.test(window.location.hostname)) {
      cmgtargetdomain = window.location.protocol + 'stage.coolmath-games.com';
    }
    if (game_type == "html5") {
      document.getElementById("html5game").contentWindow.unlockAllLevels();
    } else {
      if (cmgorigindomain.test(window.location.hostname)) {
        document.getElementById("swfObjID").unlockAllLevels();
      } else {
        var recievergameFrame = document.getElementById("swfgame");
        gDate = new Date();
        recievergameFrame.contentWindow.postMessage('unlockAllLevels', cmgtargetdomain); // TODO -- put target origin
      }
    }
  }
  function addSubToUnlockGAEvent() {
    trackEvent('Unlock All Levels category', 'subscribe to unlock button clicked', document.title);
    trackGoalVirtualPV('/virtual/unlock-button-click');
    window.location.href = "https://www.coolmathgames.com/signup/ b2df5a33?origin= /0-idle-breakout&stual=1"
  }
  var immersive_mode_enabled = false;
  // Rules for big screen free trial
  function valid_big_screen_ft() {
    validUserMode = false;
    cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) : 0;
    //Logged in user
    if(getCookie('cmg_fx') !== null && getCookie('cmg_uid') !== null) {
      cmg_uid_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
      if(cmg_uid_bsft !== null) {
        cmg_bsft = parseInt(cmg_uid_bsft);
      } else {
        cmg_bsft = 0;
      }
    }
    if (cmg_bsft <= 3) {
      validUserMode = true;
    }
    return validUserMode;
  }
  function immersive_mode_display_controller() {
    var validUserMode = false;
    if (getCookie('cmg_editor') !== null) { // display game for editors
      removePrerollAndDisplayGame();
      validUserMode = true;
    }
    if (getCookie('cmg_sx') !== null || getCookie("cmg_wl") !== null) { // display xp bar for premium users
      $('.game-xp-bar-immerse-button').addClass('enabled');
      jQuery('.btn.btn-primary.btn-sm.requestfullscreen').css('display', 'inline-block');
      validUserMode = true;
    } else if (getCookie('cmg_fx') !== null) { // Is valid Freemium user free trial ?
      if (valid_big_screen_ft()) {
        validUserMode = true;
      } else {
        validUserMode = true;
        //console.log("User reached FT limit. Display Big screen button ?");
      }
    } else { // Is valid Anonymous user free trial ?
      if (valid_big_screen_ft()) {
        validUserMode = true;
      }
    }

    if (validUserMode && ! immersive_mode_enabled) {
      immersive_mode_enabled = true;
      immersive_mode_display();
    }
  }
  var bigScreenTimer = null;
  bigScreenActive = false;
  function cmg_bigscreen_trackevent(type, trial_num) {
    if(jQuery('#big-screen-truex-overlay').length) {jQuery('#big-screen-truex-overlay').hide();}
    var tCat = 'BigScreen-Trial';
    if(cmg_stop_truex_promo === '' || cmg_stop_truex_promo !== 'yes') {
      var tCat = 'BigScreen-TrueX-Promo';
    }
    var tUsr = 'Anonymous user';
    if (typeof getCookie === 'function' && (getCookie('cmg_sx') !== null || getCookie('cmg_wl') !== null)) {
      tUsr = 'Subscriber';
    } else if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null) {
      tUsr = 'Freemium user';
    }
    var tEvt = tUsr +' trial ' + trial_num + ' - '+ type;
    if(cmg_stop_truex_promo === '' || cmg_stop_truex_promo !== 'yes') {
      tEvt = tUsr +' TrueX Promo' + ' - '+ type;
    } else {
      if(trial_num > 3) {
      	tEvt = tUsr +' no more trial ' + ' - '+ type;
      }
    }
    if(type === 'enter' || type === 'exit' || type === 'closesignup' || type == 'closepromo' || type == 'bigscreen-exit') {
      trackEvent(tCat, tEvt, document.title);
    } else if(type === 'exit2signup' || type === 'signup') {
      if(cmg_stop_truex_promo === '' || cmg_stop_truex_promo !== 'yes') {
        var sLeg = get_premium_access_leg_desc('849ef809');
        if (typeof getCookie === 'function' && getCookie('cmg_fx') !== null && (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null)) {
          sLeg = get_premium_access_leg_desc('e180e28d');
        }
        trackEvent(tCat, tEvt + ' - Leg - ' + sLeg, document.title);
      } else {
        var sLeg = get_premium_access_leg_desc('1bb008bd');
        if (typeof getCookie === 'function' && getCookie('cmg_fx') !== null && (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null)) {
          sLeg = get_premium_access_leg_desc('7859e605');
        }
        trackEvent(tCat, tEvt + ' - Leg - ' + sLeg, document.title);
      }
    } else {
      trackEvent(tCat, type, document.title);
    }
  }
  popover_login_click = false;

  function cmg_display_login_page() {
    //console.log("login link clicked in popup message");
    popover_login_click = true;
    if(jQuery('#popover' + gameId).length) {
      jQuery('#popover' + gameId).remove();
      immerse_hover_on = 0;
    }
    window.location = "/login?destination="+window.location.pathname
  }

  function display_cmg_overlay_signupform(variant) {
    //console.log("BIG SCREEN display_cmg_overlay_signupform: "+new Date());
    if(jQuery('#popover' + gameId).length) {
      jQuery('#popover' + gameId).remove();
      immerse_hover_on = 0;
    }
    //track event of type  'signup'
    if(typeof cmg_bsft === 'undefined') {
      cmg_bsft = 0;
      if(getCookie('cmg_fx') === null) {
        cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) : 0;
      } else if(getCookie('cmg_uid') !== null && getCookie('cmg_bsft_'+getCookie('cmg_uid')) !== null) {
        cmg_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
      }
    }
    cmg_bigscreen_trackevent('signup', cmg_bsft);
    if ((getCookie('cmg_sx') === null && getCookie('cmg_wl') === null)) {
      myStopFunction();
    }
    //Check if A/B test is available
    if (typeof signup_abtest_cmg_bsft !== 'undefined') {
      //variant = signup_abtest_cmg_bsft;
    }
    if (typeof variant === 'undefined' || variant === '') {
      variant = '/16'; // 14b, 15c, 16
    }

    if (cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes' && jQuery('#big-screen-overlay').length) {
      jQuery('#big-screen-overlay').show();
    } else if(cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes') {
      var big_screen_url = '';
      if (getCookie('cmg_fx') === null) {
        //big_screen_url = '/premium-access/1bb008bd' + variant + '?ts='+new Date().getTime();//Bigscreen trial plans
        big_screen_url = '/premium-access/849ef809' + variant + '?ts='+new Date().getTime();//BSWOJ anon plan
      } else {
        //big_screen_url = '/premium-access/7859e605' + variant + '?ts='+new Date().getTime();//BSFT logged-in user plan
        big_screen_url = '/premium-access/e180e28d' + variant + '?ts='+new Date().getTime();//BSWOJ logged-in user plan
      }
      if (variant == 'thankyou') {
        big_screen_url = '/signup/thank-you/overlay?ts=1596827222&src=wc&origin=/premium-access/1bb008bd/14b&sp=0&cmgtypl=1bb008bd&cmgovly=1';
      }
      if(/coolmathgames/.test(location.host)) {
        //big_screen_url = "https://" + location.host + big_screen_url;
      }
      var ov_css = 'style="display:none; position: fixed; z-index: 100000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);" min-height="1040px"';
      var ovc_css = 'style="margin: auto; padding: 10px; width: 850px;" min-height="540px"';
      var iframe_overlay = '<div id="big-screen-overlay" ' + ov_css + ' width="90%" height="90%"><div class="big-screen-signup-container" ' + ovc_css + ' ><a class="btn-close" onclick="cmg_bigscreen_trackevent(\'closesignup\', cmg_bsft); return false;" href="/"><i class="fa fa-circle fa-stack-1x"></i><i class="fa fa-times fa-stack-1x" aria-hidden="true"></i></a><iframe src="' + big_screen_url + '" width="100%" height="100%" min-height="1000px" id="big_screen_iframe" scrolling="no"></iframe></div></div>';
      // TODO Add this iframe at the correct place that it needs to go.
      jQuery('.global-wrapper').before(iframe_overlay); // TODO
      jQuery('#big_screen_iframe').css('height', '800px');
      jQuery('#big-screen-overlay').fadeIn(1000);
      jQuery('.big-screen-signup-container .btn-close').on('click', function (e) {
        e.preventDefault();
        jQuery('#big-screen-overlay').hide();
      });
    } else {
      var big_screen_url = '';
      if (getCookie('cmg_fx') === null) {
        //big_screen_url = '/premium-access/1bb008bd' + variant + '?ts='+new Date().getTime();
        big_screen_url = '/premium-access/849ef809' + variant + '?ts='+new Date().getTime();//BSWOJ anon plan
      } else {
        //big_screen_url = '/premium-access/7859e605' + variant + '?ts='+new Date().getTime();
        big_screen_url = '/premium-access/e180e28d' + variant + '?ts='+new Date().getTime();//BSWOJ logged-in user plan
      }
      if (variant == 'thankyou') {
        big_screen_url = '/signup/thank-you/overlay?ts=1596827222&src=wc&origin=/premium-access/849ef809/14b&sp=0&cmgtypl=1bb008bd&cmgovly=1';
      }
      if(/coolmathgames/.test(location.host)) {
        //big_screen_url = "https://" + location.host + big_screen_url;
      }
      var ov_css = 'style="display:none; position: fixed; z-index: 100000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);" min-height="1040px"';
      var ovc_css = 'style="margin: auto; padding: 10px; width: 850px;" min-height="540px"';
      var iframe_overlay = '<div id="big-screen-overlay" ' + ov_css + ' width="90%" height="90%"><div class="big-screen-signup-container" ' + ovc_css + ' ><a class="btn-close" onclick="cmg_bigscreen_trackevent(\'closesignup\', cmg_bsft); return false;" href="/"><i class="fa fa-circle fa-stack-1x"></i><i class="fa fa-times fa-stack-1x" aria-hidden="true"></i></a><iframe src="' + big_screen_url + '" width="100%" height="100%" min-height="1000px" id="big_screen_iframe" scrolling="no"></iframe></div></div>';
      // TODO Add this iframe at the correct place that it needs to go.
      jQuery('.global-wrapper').before(iframe_overlay); // TODO
      jQuery('#big_screen_iframe').css('height', '800px');
      jQuery('#big-screen-overlay').fadeIn(1000);
      jQuery('.big-screen-signup-container .btn-close').on('click', function (e) {
        e.preventDefault();
        jQuery('#big-screen-overlay').hide();
      });
    }
  }
  function immersive_mode_exit_handler(variant) {
    bigScreenActive = false;
    cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) : 0; // we do not increment in exit handler
    //Logged in user
    if(getCookie('cmg_fx') !== null && getCookie('cmg_uid') !== null) {
      cmg_uid_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
      if(cmg_uid_bsft !== null) {
        cmg_bsft = parseInt(cmg_uid_bsft);
      } else {
        cmg_bsft = 0;
      }
    }
    if (cmg_bsft >= 3 && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) { // Redirect the user to signup page
      if (jQuery.fullscreen.isFullScreen()) {
        jQuery.fullscreen.exit();
      }
      if(cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes') {
	      //track event of type  'exit2signup'
        cmg_bigscreen_trackevent('exit2signup', cmg_bsft);
      	display_cmg_overlay_signupform(variant);
      } else {
      	cmg_bigscreen_trackevent('bigscreen-exit', cmg_bsft);
      }
    } else if (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
      myTimerAction();
    }
    if (bigScreenTimer) {
      clearTimeout(bigScreenTimer);
      bigScreenTimer = null;
    }
    if(cmg_bsft < 3) {
    	//track event of type  'exit'
      cmg_bigscreen_trackevent('exit', cmg_bsft);
    }
  }
  function bigScreenTimerAction() {
    cmg_bsft = 3;
    if (typeof bigScreenActive !== 'undefined' && bigScreenActive) {
      if(getCookie('cmg_fx') !== null && getCookie('cmg_uid') !== null) {
        //Logged in user
        cmg_uid_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
        if(cmg_uid_bsft !== null) {
          //cmg_bsft = parseInt(cmg_uid_bsft) + 1;
          cmg_bsft = 3;//3011
        } else {
          cmg_bsft = 3;//3011
        }
        //Ajax request to update user object
        url = "/ajax/cmgbsft/" + getCookie('cmg_uid') + '/' + cmg_bsft ;//+ '?' + new Date().getTime();
        status = 0;
        jQuery.getJSON(url, function(data) {
          if (typeof data.uid !== 'undefined' && data.cmgbsft !== 'undefined') {
            status = 1;
          }
        });
        //setCookie('cmg_bsft_'+getCookie('cmg_uid'), cmg_bsft, 365 * 24 * 60 * 60 * 1000);
      } else {
        //Anon user
        //cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) + 1 : 1;
        cmg_bsft = 3;//3011
      	setCookie('cmg_bsft', cmg_bsft, 365 * 24 * 60 * 60 * 1000);
      }
      clearTimeout(bigScreenTimer);
      bigScreenTimer = null;
    }
  }
  var immerse_hover_on = 0;
  var immerse_hover_in = 0;
  var big_screen_msg_on = 0;
  function immersive_popover_msg() {
    var popover_msg = "New Premium Feature! Try it for FREE now";
    if ((getCookie('cmg_sx') !== null || getCookie('cmg_wl') !== null)) {
      popover_msg = "New Premium Feature! Try it now!";
    } else {
      cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) : 0;
      //Logged in user
      if(getCookie('cmg_fx') !== null && getCookie('cmg_uid') !== null) {
        cmg_uid_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
        if(cmg_uid_bsft !== null) {
          cmg_bsft = parseInt(cmg_uid_bsft);
        } else {
          cmg_bsft = 0;
        }
      }
      // setCookie('cmg_bsft', cmg_bsft, 365*24*60*60*1000);todo in timer function after bigscreen is active for a minute
      if (cmg_bsft === 1) {
        popover_msg = "2 Free Trials Remaining";
      } else if (cmg_bsft === 2) {
        popover_msg = "1 Free Trial Remaining";
      } else if (cmg_bsft >= 3) {
        var variant = '';
        if (typeof signup_abtest_2_variations_adfree_modular !== 'undefined') {
          variant = '/'.signup_abtest_2_variations_adfree_modular;
        }
        if (getCookie('cmg_fx') !== null) {
          popover_msg = 'BIG SCREEN is a Premium Feature. <br/>Please <a onclick=\'display_cmg_overlay_signupform(); return false;\' href=\'/premium-access/7859e605' + variant + '\'>Sign Up</a>';
        } else {

          popover_msg = 'BIG SCREEN is a Premium Feature. <br/>Please <a onclick=\'display_cmg_overlay_signupform(); return false;\' href=\'/premium-access/1bb008bd' + variant + '\'>Sign Up</a> or <a onclick=\'cmg_display_login_page(); return false;\' href=\'/login\'>Log In</a>.';
        }
      }
    }
    return popover_msg;
  }
  var cmg_bs_popover_prefix = '<div class="popover fade bs-popover-top show" role="tooltip" id="popover' + gameId + '" x-placement="top" ';
  var cmg_bs_popover_suffix1 = '><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body">';
  var cmg_bs_popover_suffix2 = '</div></div>';

  //Display BS TrueX options overlay
  network_user_id = '';
  truex_options = null;
  truex_ad_available = 0;
  //make call to trueX for available ads
	function requestTrueXAdsAndDisplay(client) {
	  //log("Ads Requested");
	  client.requestActivity(function (truexAd) {
	    //var truexAd = ads.shift();
	    if (truexAd) {
	      truex_ad_available = 1;
	      //trackEvent('View a Sponsored Video', 'TrueX Ad Available', document.title);
	      log("Bigscreen Truex Ad client loaded and ad available");
	      showTrueXOptIn(truexAd, client);
	    } else {
	      //log("No ads available.");
	      log("Bigscreen Truex Ad NOT available. Pre-roll video ad shall be displayed");
	      //trackEvent('View a Sponsored Video', 'TrueX Ad Not Available', document.title);
	      truex_ad_available = 0;
	    }
	  });
	}

	function showTrueXOptIn(truexAd, client) {
	  // add TrueX event handlers
	  truexAd.onStart(function (activity) {
	    // ad started
	    log("Bigscreen Truex Ad start");
	    //cmg_bigscreen_trackevent
	    trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Start', document.title);
	    //<h2>PLAY BIG SCREEN AFTER THIS 30 SECOND AD</h2>
	    jQuery('#big-screen-truex-header-text').css('padding-top', '14px').html('<h2 style="font-size: 22px;">PLAY BIG SCREEN AFTER THIS 30 SECOND AD</h2>');//.css('margin-top', '150px');
	    //jQuery('#big-screen-signup-container-id').css('margin-top', '0').css('margin', 'auto');
	    myStopFunction();
	    trueXTimer = setTimeout(function () {
	      jQuery('#big-screen-truex-header-text').css('background-color', '#16202c').css('padding-top', '14px').html('<h2 style="font-size: 22px;">PLEASE INTERACT WITH THIS AD TO CONTINUE</h2>');//.css('margin-top', '150px');
      }, 25 * 1000);
	  });
	  truexAd.onCredit(function (engagement) {
	    // user spent 30 seconds and interacted at least once
	    log("Bigscreen Truex Ad credit");
	    trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Credited', document.title);
	    //<div class="continue-link-yellow"> text to write â–¶</div>
	    jQuery('#big-screen-truex-header-text').css('background-color', '#16202c').css('padding-top', '14px').html('<h2><a href="" style="font-size: 22px; text-decoration: none; color:#F5E61F; " id="truex-bigscreen-activate-id" class="truex-bigscreen-activate">PLAY BIG SCREEN NOW â–¶</a></h2>');
	    document.getElementById("truex-bigscreen-activate-id").onclick = function () {
	      event.preventDefault();
	      if(typeof bigScreenActive === 'undefined' || typeof bigScreenActive !== 'undefined' && !bigScreenActive) {
	        jQuery('#big-screen-signup-container-id').html("");
	  	    jQuery('#big-screen-truex-overlay').remove();
	  	    cmg_start_game_full_screen('truex');
	      }
	    }
	    //console.log(engagement);
	  });
	  truexAd.onClose(function (activity) {
	    // user closed the ad unit
	    log("Bigscreen Truex Ad close");
	    trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Closed', document.title);
	    containerClose();
	    requestTrueXAdsAndDisplay(client);
	  });
	  truexAd.onFinish(function (activity) {
	    // user got to end of ad
	    log("Bigscreen Truex Ad finish");
	    trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Finished', document.title);
	    jQuery('#big-screen-signup-container-id').html("");
	    jQuery('#big-screen-truex-overlay').remove();
	    //full screen
	    cmg_start_game_full_screen("truex");
	  });
	  truexAd.onMessage(function (payload) {
	    //log("onMessage = " + payload);
	  });


	  // track TrueX Trigger Point Impression
	  //client.trackTriggerPointImpression(truexAd);

	  // handle opt-in click event
	  // add TrueX Opt-in to DOM
	  if(jQuery("#cmg-big-screen-truex-activity").length) {
	    var truex_container = document.getElementById("cmg-big-screen-truex-activity");
		  document.getElementById("cmg-big-screen-truex-activity").onclick = function () {
  		  //truex_preroll_display_handler();
  		  event.preventDefault();
    	  trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: Button clicked', document.title);
    	  jQuery('.big-screen-options-container').hide();
    	  if(truex_ad_available && typeof client !== 'undefined') {
    		  //BigScreen-TrueX-Promo
    		  log("Bigscreen Truex ad available. Show Truex activity");
    		  trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Loading', document.title);
    		  client.loadActivityIntoContainer(truexAd, 'big-screen-signup-container-id', { width: "960px", height: "540px" });
    	    //show_big_screen_preroll_ad();//test preroll
    		} else {
    			log("Bigscreen Truex ad not available. Instead show preroll video");
    			//TODO: Show preroll
    			truex_overlay_preroll_ad_display = true;
    			show_big_screen_preroll_ad();
    			trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: Preroll Ad Loading', document.title);
    		}
  	  };
	  }

	  //cmg-big-screen-truex-signup
	  if(jQuery("#cmg-big-screen-truex-signup").length) {
  	  document.getElementById("cmg-big-screen-truex-signup").onclick = function () {
  	    log("Bigscreen button clicked");
  	    event.preventDefault();
  	    //jQuery('.big-screen-options-container').hide();
  	    jQuery('#big-screen-truex-overlay').remove();
  	    display_cmg_overlay_signupform();
  	  };
	  }
	}
	function truex_preroll_display_handler() {
		//log("Truex ad is available. Show truex activity");
	  event.preventDefault();
	  trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: Button clicked', document.title);
	  jQuery('.big-screen-options-container').hide();
	  if(truex_ad_available && typeof client !== 'undefined') {
		  //BigScreen-TrueX-Promo
		  trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: TrueX Ad Loading', document.title);
		  client.loadActivityIntoContainer(truexAd, 'big-screen-signup-container-id', { width: "960px", height: "540px" });
	    //show_big_screen_preroll_ad();//test preroll
		} else {
			//log("Truex ad not available. Instead show preroll video");
			//TODO: Show preroll
			truex_overlay_preroll_ad_display = true;
			show_big_screen_preroll_ad();
			trackEvent('BigScreen-TrueX-Promo', 'View a Sponsored Video: Preroll Ad Loading', document.title);
		}
	}
	function containerClose() {
	  //log("containerClose called.");
	}
	function log(msg) {
	  console.log("CMG [%s] - %s", new Date().toLocaleTimeString(), msg);
	}
	cmg_truex_promo_events_added = 0;
  function display_big_screen_truex_options_overlay() {
  	//initialize trueX ad client w/ options hash
  	trackEvent('BigScreen-TrueX-Promo', 'Bigscreen button clicked', document.title);
  	if(getCookie('cmg_sx') !== null || getCookie('cmg_wl') !== null ) {
    	event.preventDefault();
    	cmg_start_game_full_screen('truex');
    } else {
      network_user_id = getCookie('_ga');
      if(typeof network_user_id !== 'undefined' && network_user_id !== '') {
        network_user_id = network_user_id.replace('GA', 'cmg');
      }
      //TRUEX Test Hash
      //truex_options = {'network_user_id': network_user_id, 'partner_config_hash': '83f879b26797c723882473d6435e6361c105d86b'};
      //TRUEX Live Hash

      truex_options = {'network_user_id': network_user_id, 'partner_config_hash': '375f2f2b728700cd991bb24601b3841c98375886'};
      if(typeof truex !== 'undefined') {
        truex.client(truex_options, function (client) {
          requestTrueXAdsAndDisplay(client);
        });
      }

      var ov_css = ' style="display:none; position: fixed; z-index: 100000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.7);" min-height="1040px" ';
      var ovc_css = ' style="margin: auto; margin-top: 200px; padding: 10px; width: 424px; height: 345px; background-color: #1f4f77; border:3px solid #286aa1;" ';
      var ovc_css_id = ' style="margin: auto; margin-top: 150px; width: 960px; " ';
      var truex_css = '  ';
      var truex_options1 = '<div class="truex_options_title" ' + truex_css + '><h1>To Play This Game in Big Screen Mode</h1></div>';
      // onclick="truex_preroll_display_handler(); return false; --> below"
      var truex_options2 = '<div class="truex_options_video" ' + truex_css + '><a href="" id="cmg-big-screen-truex-activity" class="txt-bs-popup" onclick="truex_preroll_display_handler(); return false;"><h1>View a Sponsored Video</h1></a></div>';
      var truex_optionsOR = '<div class="truex_options_OR_txt" ' + truex_css + '><h1> OR </h1></div>';

      var truex_options3 = '<div class="truex_options_signup" ' + truex_css + '><a href="" id="cmg-big-screen-truex-signup"  class="txt-bs-popup" onclick="display_cmg_overlay_signupform(); return false;"><h1>Get Premium Access for $5.99/month</h1></a></div>';
      var truex_options4 = '<div class="truex_options_no_thks" ><a href="" id="cmg-big-screen-truex-promo-close" onclick="cmg_bigscreen_trackevent(\'closepromo\', cmg_bsft); return false;"  href="/">No thanks, return to regular mode</a></div>';

      var truex_options_prefix = '<div id="cmg-truex-options-container">';
      var truex_options_suffix = '</div>';
      truex_options = truex_options_prefix + truex_options1 + truex_options2 + truex_optionsOR + truex_options3 + truex_options4 + truex_options_suffix;
      var truex_options_heading = '<div id="big-screen-truex-header-text" style="text-align: center; padding: 5px; padding-top: 14px; color:#fff; font-size:22px; background-color: #484848; ">'+
      	'</div>';
      var preroll_container = '<div id="big-screen-preroll-container"><div id="videoplayer" style="width:100%;">'+
      	'<video id="content123" style="width:640px;height:1px;">'+
        	'<source src="//www.coolmathgames.com/sites/default/files/adtesting/DummyVideo.mov"></source>'+
      	'</video><div id="adcontainer" style="margin:auto; width:640px;height:480px;"></div>'+
      	'</div></div>'+
      	//'<div id="continue-container"><div id="continue-link" style="color: yellow;">Continue in </div>'+
      	//'<span id="preroll_timer_id" style="width: 1px; height: 1px;">15</span>';
      	'</div>';
      var bs_truex_options = '<div id="big-screen-truex-overlay" class="big-screen-style-popup-container" ' + ov_css + ' width="90%" height="90%">'+
      	'<div class="big-screen-options-container" ' + ovc_css +' >'+
      		'<div class="bs-pop-up-content-container"><a class="btn-close" onclick="cmg_bigscreen_trackevent(\'closepromo\', cmg_bsft); return false;" href="/">'+
      			'<i class="fa fa-times fa-stack-1x"  style="font-size:24px;"  aria-hidden="true"></i></a>' + truex_options +
      		'</div>'+
      	 '</div>'+
      	 '<div id="truex-main-container" ' + ovc_css_id + '>' + truex_options_heading +
      		'<div id="big-screen-signup-container-id"></div>'+ preroll_container +
      	 '</div>'+
      	'</div>';
   		// TODO Add this iframe at the correct place that it needs to go.
   		jQuery('.global-wrapper').before(bs_truex_options); // TODO
   		jQuery('#big_screen_iframe').css('height', '800px');
   		jQuery('.big-screen-options-container').show();
   		jQuery('#big-screen-truex-overlay').fadeIn(1000);
   		//if(!cmg_truex_promo_events_added) {
 		 	//cmg_truex_promo_events_added = 1;
   		jQuery('.big-screen-options-container .btn-close').on('click', function (e) {
        e.preventDefault();
        jQuery('#big-screen-truex-overlay').hide();
      });
   		jQuery('#cmg-big-screen-truex-promo-close').on('click', function (e) {
        e.preventDefault();
        jQuery('#big-screen-truex-overlay').hide();
      });
   		//}
  	}
  }
  function show_big_screen_preroll_ad() {
    event.preventDefault();
    jQuery('#big-screen-truex-header-text').css('padding-top', '14px').html('<h2 style="font-size: 22px;">PLAY BIG SCREEN AFTER THIS AD</h2>');
    jQuery('.big-screen-options-container').hide();

    var cmatgame_subscriber = getCookie('cmg_sx');
    var validSubscriber = false;
    if(typeof cmatgame_subscriber !== 'undefined' && cmatgame_subscriber !== null ) {
     validSubscriber = true;
    }
    //preroll ads
    var prerollUrls = /0\-testing/;
    if(!validSubscriber) {
      //display preroll ads
      window.scrollTo(0,0);
      var modal = document.getElementById('big-screen-preroll-container');
      //modal.style.display = 'block';
      //clear refresh timer
      if(typeof refreshTimer !== "undefined") {
        clearTimeout(refreshTimer);
        refreshTimer = null;
      }
      var adTagUrl = 'https://pubads.g.doubleclick.net/gampad/ads?iu=/137548614/1023174/71134/1023174-71134-video&description_url=https%3A%2F%2Fwww.coolmathgames.com%2F&env=vp&impl=s&correlator=&tfcd=0&npa=0&gdfp_req=1&output=vast&sz=640x480&unviewed_position_start=1';
      if(typeof window.PW_CMG != "undefined") {
        var auctionCallback = function(displayAds, videoUrl) {
          application = new Application(displayAds, videoUrl);
        };
        window.PW_CMG.startAuction(auctionCallback);
      } else { //adblock
        application = new Application(false, adTagUrl);
      }

      bs_preroll_timer = 15;
      bs_preroll_intervalId  = setInterval(function() {
        bs_preroll_timer--;

        jQuery('#big-screen-truex-header-text').html('<h2 style="font-size: 22px;">PLAY BIG SCREEN AFTER THIS AD: '+ bs_preroll_timer +'</h2>');
        //document.getElementById("preroll_timer_id").innerHTML = seconds_left;
        if (bs_preroll_timer <= 0) {
          jQuery('#big-screen-truex-header-text').html('<h2><a href="" style="font-size: 22px; text-decoration: none; color:#F5E61F; " id="truex-bigscreen-activate-id" class="truex-bigscreen-activate">PLAY BIG SCREEN NOW â–¶</a></h2>');
          document.getElementById("truex-bigscreen-activate-id").onclick = function () {
    	      event.preventDefault();
    	      if(typeof bigScreenActive === 'undefined' || typeof bigScreenActive !== 'undefined' && !bigScreenActive) {
    	        jQuery('#big-screen-signup-container-id').html("");
    	  	    jQuery('#big-screen-truex-overlay').remove();
    	  	    cmg_start_game_full_screen('truex');
    	      }
    	    }
          clearInterval(bs_preroll_intervalId);
        }
      }, 1000);
    }
  }
  //TRUEX end
  function cmg_start_game_full_screen(cmgsource) {
    myStopFunction(); // no ad refresh
    bigScreenActive = true;
    //console.log("Starting fullscreen");
    if(cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes') {
      //trackEvent('BigScreen-Trial', 'Bigscreen activated', document.title);
      cmg_bigscreen_trackevent('enter', cmg_bsft);
      bigScreenTimer = setTimeout(function () {
        bigScreenTimerAction();
      }, 60 * 1000);
    } else {
      //trackEvent('BigScreen-TrueX-Promo', 'Bigscreen activated', document.title);
      cmg_bigscreen_trackevent('enter', 0);
    }
    var elem = document.getElementById('block-system-main');
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.mozRequestFullScreen) { /* Firefox */
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { /* IE/Edge */
      elem.msRequestFullscreen();
    }
  }
  function immersive_mode_display() {
    var popover_msg = immersive_popover_msg();
    var immerse_prefix = '<a class="btn btn-primary btn-sm requestfullscreen" href="#">'; // do not add title
    var immerse_suffix = '<i class="fa fa-arrows-alt" aria-hidden="true"></i></a>';
    var immerse_html = '<span class="big-screen-popover-span" data-toggle="popover" data-trigger="focus" data-placement="top" data-content="' + popover_msg + '">Big Screen</span>';

    $(".immerse-button").html(immerse_prefix + immerse_html + immerse_suffix);
    if(getCookie('cmg_fx') !== null) {
      jQuery('.node-type-game.logged-in .requestfullscreen').css('display', 'inline-block');
    }
    if(getCookie('cmg_sx') !== null || getCookie('cmg_wl') !== null) {
      jQuery('.immerse-button a.btn').css('background-image', 'url("https://www.coolmathgames.com/sites/default/files/styles/WATCH-AD-TO-PLAY-BIG-SCREEN-vSub.png")').css('width', '132px')
    }

    // get game
    var elem = document.getElementById('block-system-main');
    // open game in fullscreen
    $('.immerse-button .requestfullscreen').on('click', function (e) {
      e.preventDefault();
      if(cmg_stop_truex_promo === '' || cmg_stop_truex_promo !== 'yes') {
    		//TODO: Return from here or not?
      	display_big_screen_truex_options_overlay();
      	return;
      }
      if(jQuery('#popover' + gameId).length) {
        jQuery('#popover' + gameId).remove();
        immerse_hover_on = 0;
      }
      cmg_bsft = getCookie('cmg_bsft') !== null ? parseInt(getCookie('cmg_bsft')) : 0;
      //Logged in user
      if(getCookie('cmg_fx') !== null && getCookie('cmg_uid') !== null) {
        cmg_uid_bsft = getCookie('cmg_bsft_'+getCookie('cmg_uid'));
        if(cmg_uid_bsft !== null) {
          cmg_bsft = parseInt(cmg_uid_bsft);
        } else {
          cmg_bsft = 0;
        }
      }
      if(cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes') {
      	if(cmg_bsft < 3) {
          //track event of type  'enter'
          cmg_bigscreen_trackevent('enter', cmg_bsft+1);
        }
        if (getCookie('cmg_sx') !== null || getCookie("cmg_wl") !== null || cmg_bsft < 3) {
          cmg_start_game_full_screen();
        } else {
          //console.log("BIG SCREEN You have reached a FT limit");
          //Display signup form
          if(getCookie('cmg_sx') === null && getCookie('cmg_wl') === null && !popover_login_click) {
            display_cmg_overlay_signupform();
          }
          //track event of type  'signup'
          //cmg_bigscreen_trackevent('signup', cmg_bsft+1);
        }
      } else {
        //Big Screen - TrueX Integration
        //TODO conditions to check or when to display the overlay
        if (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
          //console.log("Big screen button clicked. display the overlay with options");
          display_big_screen_truex_options_overlay();
        } else {
          if(cmg_bsft < 3) {
            //track event of type  'enter'
            cmg_bigscreen_trackevent('enter', cmg_bsft+1);
          }
          if (getCookie('cmg_sx') !== null || getCookie('cmg_wl') !== null || cmg_bsft < 3) {
            cmg_start_game_full_screen();
          } else {
            //console.log("BIG SCREEN You have reached a FT limit");
            //Display signup form
            if(getCookie('cmg_sx') === null && getCookie('cmg_wl') === null && !popover_login_click) {
              //display_cmg_overlay_signupform();
            }
            //track event of type  'signup'
            //cmg_bigscreen_trackevent('signup', cmg_bsft+1);
          }
        }
      }
    });
    if(cmg_stop_truex_promo !== '' && cmg_stop_truex_promo === 'yes') {
      $('.immerse-button .requestfullscreen').hover(function () { // hover in
        //console.log("Bigscreen button hover in "+new Date());
        immerse_hover_in = 1;
        if (!immerse_hover_on) {
          popover_msg = immersive_popover_msg();
          var popover_html = cmg_bs_popover_prefix + cmg_bs_popover_suffix1 + popover_msg + cmg_bs_popover_suffix2;
          $(".immerse-button .big-screen-popover-span").after(popover_html);
          var width = $(".immerse-button").find('.requestfullscreen').width();
          var height = $(".immerse-button").find('.popover').height();
          var xPos = '-' + (width/2);
          var yPos = '-' + (height + 5);
          $(".immerse-button").find('.popover').css("transform","translate3d("+ xPos +"px, "+ yPos + "px, 0)");

          immerse_hover_on = 1;
          if (jQuery('#popover' + gameId).length) {
            jQuery('#popover' + gameId).hover(function () {
              //console.log("Popover message hover in "+ new Date());
              big_screen_msg_on = 1
            }, function () {
              //console.log("Popover message hover out "+ new Date());
              big_screen_msg_on = 0;
            });
          }
        }
      }, function () { // hover out
        //console.log("Bigscreen button hover out "+ new Date());
        immerse_hover_in = 0;
        setTimeout(function () {
          if (immerse_hover_on && !immerse_hover_in && !big_screen_msg_on) {
            jQuery('#popover' + gameId).remove();
            immerse_hover_on = 0;
          }
        }, 1 * 1000);
      });
    }

    // close game fullscreen
    $('#block-system-main .close-full-screen').on('click', function (e) {
      e.preventDefault();
      immersive_mode_exit_handler();
      jQuery.fullscreen.exit();
    });
    $('body').keypress(function (e) {
      if (e.which == 27) {
        if ($('.immerse-button .requestfullscreen').length && typeof bigScreenActive !== 'undefined' && bigScreenActive) {
          immersive_mode_exit_handler();
          // jQuery.fullscreen.exit();
        }
      }
    });

    var screen_change_events = "webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";

    // toggle full screen window class
    jQuery(document).on(screen_change_events, function () {
      if (jQuery.fullscreen.isFullScreen()) {
        elem.classList.add('full-screen-window');
        var iframe = document.getElementById('html5game') ? document.getElementById('html5game') : document.getElementById('swfgame');
        var iframeWidth = parseInt(iframe.width);
        var iframeHeight = parseInt(iframe.height);
        var windowWidth = parseInt(screen.width);
        var windowHeight = parseInt(screen.height) - 75;
        var xpbarPos = (windowHeight + 75 - iframeHeight) / 2 + iframeHeight + 10;
        $('.game-xp-bar-immerse-button').css('top', xpbarPos + "px");

        if ($("body").hasClass("game-scalable")) {
          if (iframeHeight > windowHeight) {
            var ratio = iframeHeight / windowHeight;
          } else {
            var ratio = windowHeight / iframeHeight;
          }

          // Calculating game width based on window height
          var gameWidth = iframeWidth * ratio;

          // apply new width and height with iframe and xp bar
          iframe.style.width = gameWidth + "px";
          iframe.style.height = windowHeight + "px";
          var xpbarPos = windowHeight + 10;
          $('.game-xp-bar-immerse-button').css('top', xpbarPos + "px");
        } else if ($("body").hasClass("game-full-screen")) { // apply new width and height with iframe and xp bar
          iframe.style.width = windowWidth + "px";
          iframe.style.height = windowHeight + "px";
          var xpbarPos = windowHeight + 10;
          $('.game-xp-bar-immerse-button').css('top', xpbarPos + "px");
        }
      } else {
        immersive_mode_exit_handler();
        elem.classList.remove('full-screen-window');
        $('#html5game').removeAttr("style");
        $('#swfgame').removeAttr("style");
        $('.game-xp-bar-immerse-button').removeAttr("style");
      }
    });
  }
</script>

  <script type="text/javascript">
    hide_preroll_ads = false;
    var cmg_active_anonymous_user = getCookie('cmg_active_anonymous_user');
    if (cmg_active_anonymous_user != null && !/0-chess/.test(window.location.pathname)) { // setCookie('cmg_active_anonymous_user', 'active', 30*60*1000);
    }
  </script>
<div id="afg_container">
  <style type="text/css">
.load-wrap {
  width: 100%;
}

.circle {
  display: inline-block;
  height: 15px;
  width: 15px;
  margin-right: 20px;
  background-color: #fc6e51;
  border-radius: 50%;
  -webkit-animation: afg_container_loading 1.6s infinite;
  -moz-animation: afg_container_loading 1.6s infinite;
  -o-animation: afg_container_loading 1.6s infinite;
  animation: afg_container_loading 1.6s infinite;
}

.load-wrap .circle:nth-child(3) {
  -webkit-animation-delay: 0.1s;
  -moz-animation-delay: 0.1s;
  -o-animation-delay: 0.1s;
  animation-delay: 0.1s;
  background: #f8eb13;
  margin: -20px 5px 40px 360px;
}

.load-wrap .circle:nth-child(4) {
  -webkit-animation-delay: 0.3s;
  -moz-animation-delay: 0.3s;
  -o-animation-delay: 0.3s;
  animation-delay: 0.3s;
  background: #33a2da;
  margin: -20px 5px 40px;
}

.load-wrap .circle:nth-child(5) {
  -webkit-animation-delay: 0.5s;
  -moz-animation-delay: 0.5s;
  -o-animation-delay: 0.5s;
  animation-delay: 0.5s;
  background: #ee3928;
  margin: -20px 5px 40px;
}

.load-wrap .circle:nth-child(6) {
  -webkit-animation-delay: 0.7s;
  -moz-animation-delay: 0.7s;
  -o-animation-delay: 0.7s;
  animation-delay: 0.7s;
  background: #51b747;
  margin: -20px 5px 40px;
}
/* Keyframes */
@
-webkit-keyframes afg_container_loading { 0%, 100% {
  -webkit-transform: scale(0.0);
}

50%
{
-webkit-transform
:

scale
(1
.0
);


}
}
@
-moz-keyframes afg_container_loading { 0%, 100% {
  -moz-transform: scale(0.0);
}

50%
{
-moz-transform
:

scale
(1
.0
);


}
}
@
-o-keyframes afg_container_loading { 0%, 100% {
  -o-transform: scale(0.0);
}
@ -moz-keyframes afg_container_loading {
  0,
  100% {
    -moz-transform: scale(0.0);
  }

50%
{
-o-transform
:

scale
(1
.0
);


}
}
@
keyframes afg_container_loading { 0%, 100% {
  transform: scale(0.0);
}
@ -o-keyframes afg_container_loading {
  0,
  100% {
    -o-transform: scale(0.0);
  }

  50% {
    -o-transform: scale(1 .0);
  }
}
@ keyframes afg_container_loading {
  0,
  100% {
    transform: scale(0.0);
  }
  50% {
    transform: scale(1 .0);
  }
}
</style>
  <div class="load-wrap">
    <script type="text/javascript">
        // IE Detection and Version grabbing
        ie = false;
        if (navigator.appName == "Microsoft Internet Explorer") {
          ie = true;
          var ua = navigator.userAgent;
          var re = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
          if (re.exec(ua) != null) {
            ieVersion = parseInt(RegExp.$1)
          }
        }
        if (ie && ieVersion <= 9) {
          document.write('<h3 style="margin:20px 20px; font-size: 20px">Just a moment while your game loads...</h3>' + signupContainerTop);
        } else {
          document.write('<h3 style="margin:20px 20px 0 0; font-size: 20px">Just a moment while your game loads</h3><div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div>' + signupContainerTop);
        }
      </script>
  </div>
</div>
 <!--Start of Preloader call -->
<div id="afg_preloader">
  <div id="container123">
    <div id="videoplayer">
      <video id="content123" style="height: 1px; width: 640px;">
        <source
          src="//www.coolmathgames.com/sites/default/files/adtesting/DummyVideo.mov"></source>
      </video>
      <div id="adcontainer" style="height: 480px; width: 640px;"></div>
    </div>
  </div>
    <!-- Continue to Game container with timer -->
    <div id="continue-container" style="display:none">
      <div id="img-button-container">
        <div id="img-button-self" class="img-button">
          <input type="image" src="/themes/custom/cmatgame/images/coolmathgames_skip-the-ads-button3a.png" alt="Submit"  class="skip-ad-btn"  onclick="redirectpremium();">
        </div>
      <div class="continue-lnk-container-rsection">
        <div id="continue-link">Continue in </div>
        <div id="timer_div" style="margin-left:5px;">15</div>
      </div>
    </div>
  </div>


  <script type="text/javascript"
    src="//cdn.intergi.com/prebid/cmg-prebid.js"></script>
  <script type="text/javascript"
    src="//cdn.intergi.com/cmg/cmg-headerbidding.js"></script>
  <script type="text/javascript"
    src="//imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
  <script type="text/javascript">
      function redirectpremium(){
       //location.href= "/premium-access/";
       event.preventDefault();
       var sLeg = get_premium_access_leg_desc('2efa4bc4');
       var path = '/premium-access/2efa4bc4';
       if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
         path = '/premium-access/bd07c4e6';
         sLeg = get_premium_access_leg_desc('bd07c4e6');
       }
       trackEvent('Premium Subscription - '+sLeg, "Preroll - Skip Ads Go VIP Now - button clicked", document.title);
       window.location.href = window.location.protocol + '//' + window.location.host + path + get_signup_abtest_variant_3();
      }

    displayAdblockOverlay = false;
    if (typeof cmgpbjs == "undefined") { // cmgpbjs is defined in ads, so if it undefined means, adblocker is detected
      displayAdblockOverlay = true;
    }


    /**
                        * Handles user interaction and creates the player and ads controllers.
                        */
    var Application = function (displayAds, adTagUrl) {
      this.playing_ = false;
      this.adsActive_ = false;
      this.adsDone_ = false;
      if (typeof displayAds === 'undefined' || displayAds === null) {
        this.displayAds = true;
      } else {
        this.displayAds = displayAds;
      }
      this.adTagUrl_ = adTagUrl;

      this.videoPlayer_ = new VideoPlayer();
      if (this.displayAds && (typeof targeted_state === 'undefined' || watchAdtoUnlockGameIsClicked == "true")) { // console.log("Preload ads for non subscription time games");
        this.ads_ = new Ads(this, this.videoPlayer_);
        // Adx Preroll Tag with fallback display Ad The user clicked/tapped - inform the ads controller that this code is being run in a user action thread.
        this.ads_.initialUserAction();
        // At the same time, initialize the content player as well. When content is loaded, we'll issue the ad request to prevent it from interfering with the initialization. See
        // https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/ads#iosvideo for more information.
        this.videoPlayer_.preloadContent(this.bind_(this, this.loadAds_));
        this.adsDone_ = true;
      } else {
        // console.log("Do not preload ads for Get Ad Free Games user");
        // removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });
      }
    };

    Application.prototype.bind_ = function (thisObj, fn) {
      return function () {
        fn.apply(thisObj, arguments);
      };
    };

    Application.prototype.loadAds_ = function () {
      this.ads_.requestAds(this.adTagUrl_);
    };

    /**
           * Handles video player functionality.
           */
    var VideoPlayer = function () {
      this.contentPlayer = document.getElementById('content123');
      this.adContainer = document.getElementById('adcontainer');
      this.videoPlayerContainer_ = document.getElementById('videoplayer');
      this.width = 640;
      this.height = 480;
    };

    VideoPlayer.prototype.preloadContent = function (contentLoadedAction) {
      contentLoadedAction();
    };
    VideoPlayer.prototype.play = function () {
      this.contentPlayer.play();
    };

    VideoPlayer.prototype.pause = function () {
      this.contentPlayer.pause();
    };

    /**
           * Shows how to use the IMA SDK to request and display ads.
           */
    var Ads = function (application, videoPlayer) {
      this.application_ = application;
      this.videoPlayer_ = videoPlayer;
      this.customClickDiv_ = document.getElementById('customClick');
      this.contentCompleteCalled_ = false;
      google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);
      // Call setLocale() to localize language text and downloaded swfs google.ima.settings.setLocale('fr');
      this.adDisplayContainer_ = new google.ima.AdDisplayContainer(this.videoPlayer_.adContainer, this.videoPlayer_.contentPlayer, this.customClickDiv_);
      this.adsLoader_ = new google.ima.AdsLoader(this.adDisplayContainer_);
      this.adsManager_ = null;

      this.adsLoader_.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, this.onAdsManagerLoaded_, false, this);
      this.adsLoader_.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, this.onAdError_, false, this);
    };

    // On iOS and Android devices, video playback must begin in a user action. AdDisplayContainer provides a initialize() API to be called at appropriate time. This should be called when the user clicks or taps.
    Ads.prototype.initialUserAction = function () {
      this.adDisplayContainer_.initialize();
      this.videoPlayer_.contentPlayer.load();

    };

    Ads.prototype.requestAds = function (adTagUrl) {
      var adsRequest = new google.ima.AdsRequest();
      adsRequest.adTagUrl = adTagUrl;
      adsRequest.linearAdSlotWidth = this.videoPlayer_.width;
      adsRequest.linearAdSlotHeight = this.videoPlayer_.height;
      adsRequest.nonLinearAdSlotWidth = this.videoPlayer_.width;
      adsRequest.nonLinearAdSlotHeight = this.videoPlayer_.height;
      this.adsLoader_.requestAds(adsRequest);
    };

    Ads.prototype.onAdsManagerLoaded_ = function (adsManagerLoadedEvent) { // console.log('Ads loaded.');
      var adsRenderingSettings = new google.ima.AdsRenderingSettings();
      // adsRenderingSettings.loadVideoTimeout = 4000;
      adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete = true;
      this.adsManager_ = adsManagerLoadedEvent.getAdsManager(this.videoPlayer_.contentPlayer, adsRenderingSettings);
      this.adsManager_.setVolume(0);
      this.processAdsManager_(this.adsManager_);
    };

    Ads.prototype.processAdsManager_ = function (adsManager) {
      if (adsManager.isCustomClickTrackingUsed()) {
        this.customClickDiv_.style.display = 'table';
      }
      // Handle errors.
      adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, this.onAdError_, false, this);
      var events = [
        google.ima.AdEvent.Type.ALL_ADS_COMPLETED,
        google.ima.AdEvent.Type.COMPLETE,
        google.ima.AdEvent.Type.FIRST_QUARTILE,
        google.ima.AdEvent.Type.LOADED,
        google.ima.AdEvent.Type.MIDPOINT,
        google.ima.AdEvent.Type.STARTED,
        google.ima.AdEvent.Type.THIRD_QUARTILE,
        google.ima.AdEvent.Type.USER_CLOSE
      ];
      for (var index in events) {
        adsManager.addEventListener(events[index], this.onAdEvent_, false, this);
      }

      var initWidth,
        initHeight;

      initWidth = this.videoPlayer_.width;
      initHeight = this.videoPlayer_.height;

      adsManager.init(initWidth, initHeight, google.ima.ViewMode.NORMAL);

      adsManager.start();
    };
    Ads.prototype.onAdEvent_ = function (adEvent) {
      if (adEvent.type == google.ima.AdEvent.Type.LOADED) {
        var ad = adEvent.getAd();
        jQuery("#content123").hide();
      }
      //console.log("Bigscreen Pre-roll ad event "+ adEvent.type + " <-- " +Date());
      if ((typeof truex_overlay_preroll_ad_display === 'undefined' || typeof truex_overlay_preroll_ad_display !== 'undefined' && !truex_overlay_preroll_ad_display) && adEvent.type == google.ima.AdEvent.Type.COMPLETE) {
        removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });
      }
      if ((typeof truex_overlay_preroll_ad_display === 'undefined' || typeof truex_overlay_preroll_ad_display !== 'undefined' && !truex_overlay_preroll_ad_display) && adEvent.type == google.ima.AdEvent.Type.ALL_ADS_COMPLETED) {
        removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });
      }
      if ((typeof truex_overlay_preroll_ad_display === 'undefined' || typeof truex_overlay_preroll_ad_display !== 'undefined' && !truex_overlay_preroll_ad_display) && adEvent.type == google.ima.AdEvent.Type.USER_CLOSE) {
        removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });
      }
      if (typeof truex_overlay_preroll_ad_display !== 'undefined' && truex_overlay_preroll_ad_display && (adEvent.type == google.ima.AdEvent.Type.SKIPPED || adEvent.type == google.ima.AdEvent.Type.USER_CLOSE) ) {

        jQuery('#big-screen-signup-container-id').html("");
        jQuery('#big-screen-truex-overlay').remove();
        cmg_start_game_full_screen('truex');
      } else if(typeof truex_overlay_preroll_ad_display !== 'undefined' && truex_overlay_preroll_ad_display && (adEvent.type == google.ima.AdEvent.Type.ALL_ADS_COMPLETED || adEvent.type == google.ima.AdEvent.Type.COMPLETE) ) {
        if(typeof bs_preroll_timer !== 'undefined' && bs_preroll_timer > 0) {
          //console.log("Bigscreen pre-roll ad event "+ adEvent.type + " set bs_preroll_timer to 0 from "+bs_preroll_timer);
          bs_preroll_timer = 0;
        } else {
          //console.log("Bigscreen pre-roll ad event "+ adEvent.type + " bs_preroll_timer is 0 or undefined");
        }
      }
    };
    Ads.prototype.onAdError_ = function (adErrorEvent) {
      if (this.adsManager_) {
        this.adsManager_.destroy();
      }
      removePrerollAndDisplayGame();
      jQuery(document).ready(function () {
        display_game_progressbar(gameId);
      });
      // TODO remove the ad slot and display the game this.application_.resumeAfterAd();
      // TODO UNCOMMENT BELOW removePrerollAndDisplayGame();
    };

    /*
          if(typeof Drupal.settings.isSubscriptionActive != "undefined" && Drupal.settings.isSubscriptionActive == false && getCookie('cmg_l') !== null) {
            subscribeNowAlienClass = "subscribe-now-alien-subscribe";
          }else if(getCookie('cmg_l') == null) {
            subscribeNowAlienClass = "subscribe-now-alien";
          }else if(getCookie('cmg_l') == null && subscriberLeg == 'Default Leg') {
            subscribeNowAlienClass = "subscribe-now-signup";
          }
          */

    var cmatgame_subscriber = getCookie('cmg_sx');
    var validSubscriber = false;
    if (typeof cmatgame_subscriber !== 'undefined' && cmatgame_subscriber !== null) {
      validSubscriber = true;
    }
    if(getCookie("cmg_wl") !== null) {
      validSubscriber = true;
    }
    var application = null;
    var isDisplayAdBlockOverlayEligible = false;
    sessionGamesPlayed = parseInt(sessionStorage.getItem('sessionGamesPlayed') || 0);
    if (typeof window.PW_CMG == "undefined" && ((schoolHours && sessionGamesPlayed > 3) || !schoolHours)) { // adblock detection logic
      isDisplayAdBlockOverlayEligible = true;
      displayAdblockOverlay = true;
    } else {
      displayAdblockOverlay = false;
    }
    // display Ads to anonymous users the time from 7am to 13pm, display ads to anonymous users  from 13pm to 11:59pm and 00 to 7am only if the user is not from New York city
    // TODO -->  Need to add day of the week for school hours logic, day < 6
    if (schoolHours && isDisplayAdBlockOverlayEligible) {
      validReferer = false;
      schoolHours = false;
      displayAdblockOverlay = true;
    }
    if (validSubscriber || getCookie("cmg_wl") !== null) { // valid subscriber do not display Preroll Ads
      var adTagUrl = "";
      // retreive user Progress
      retrieveUserProgress();
      removePrerollAndDisplayGame();
      jQuery(document).ready(function () {
        display_game_progressbar(gameId);
      });

    }else if( typeof bigScreenPromoGame != "undefined" && bigScreenPromoGame == true && (gamesPlayed % 3 === 2)){
			/**
      *** Big Screen Promo and check for every 3rd refresh
      ***/
      jQuery("#afg_container").hide();
      jQuery('#full-screen-modal').show();
      jQuery('#big-screen-container').show();
      jQuery("#videoplayer").hide();
      if(jQuery('#right-rail-big-screen-promo').length) {
      	document.getElementById('right-rail-big-screen-promo').style.display = 'block';
        jQuery('#right-rail-big-screen-promo').show();

      }

      //show bigscreen button
      $(document).ready(function () {
        jQuery("#continue-container").hide();
        //console.log("continue container hidden");

        if(jQuery('.immerse-button').length) {
          //console.log("BIG SCREEN display big screen button for promo overlay");
          jQuery('#no-flash-overlay').hide();
          jQuery('#swfgamewrapper').hide();
        } else {
          //console.log("BIG SCREEN cannot display big screen button for promo overlay as immerse button is not available");
        }
      });

	} else if( typeof AdfreeMktCmpGame != "undefined" && AdfreeMktCmpGame == true && (gamesPlayed % 3 === 2)){
			/**
      *** Add free marketing promo Promo and check for every 3rd refresh
      ***/
      jQuery("#afg_container").hide();
      jQuery('#id-adfree-marketing-campaign').show();
	    jQuery("#videoplayer").hide();
      if(jQuery('#right-rail-big-screen-promo').length) {
      	document.getElementById('right-rail-big-screen-promo').style.display = 'block';
        jQuery('#right-rail-big-screen-promo').show();

      }

      //show bigscreen button
      $(document).ready(function () {
        if(jQuery('.immerse-button').length) {
          jQuery('#no-flash-overlay').hide();
          jQuery('#swfgamewrapper').hide();
        }
      });

		} else if (!validReferer && ( typeof supportCMG === 'boolean' && supportCMG === true  ) && (gamesPlayed % 3 === 2) ) { //subscription paywall for Support Game
          clearInterval(intervalId);
          jQuery("#afg_container").hide();
          jQuery(".title-instructions").remove();
          jQuery(".body-instructions").remove();
          jQuery(".game-xp-bar-immerse-button").remove();
          jQuery("#continue-container").hide();
           
          if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
            var planToSubscription = 'd61242ac';
          }else{
            var planToSubscription = '0735a1f2';
          }//logged in free user
          doNotDisplayPrerollTimer = true;
          var htmlPopOver = '<div id="id-cmg-default" class="cmg-default-marketing-campaign" style="display:block;"> <div class="big-screen-head"> <div class="bs-head-logo col-md-2"><img src="/themes/custom/coolmath/assets/images/full-screen/cool-math-logo.png"></div><div class="bs-head-txt col-md-8">Get Premium: The Best Gaming Experience</div><div class="bs-close-button"><a href="#" class="bs-close-btn" onclick="supportCMG_overlay_promo_close_handler(); return false;">X</a></div></div><div class="mid-big-section-head cmg-default-mid-section-marketing-campaign"> <div class="mid-img-container"> <div> <div class="img-container-cmg-default"> <div class="no-waiting-txt"> Personalized <br> Premium <br>Profile</div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/premium-avatars-small.png"> <br><span class="red-txt">Access All <br>premium avatars </div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/premium-themes-small.png"> <br><span class="offwhite-txt">Full selection <br>of themes </span></div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/custom-nicknames-small.png"> <br><span class="blue-txt">Custom <br>Nickname </span></div></div></div><div> <div class="img-container-cmg-default"> <div class="no-waiting-txt"> Distraction <br> Free Gaming & <br>Unlimited <br> Creativity</div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/big-screen-small.png"> <br><span class="light-blue-txt">Big <br>Screen </span></div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/ad-free-small.png"> <br><span class="green-txt">Ad-Free<br> Experience </span></div><div class="image-bs-sample"> <img class="img-cmgdefault" src="/themes/custom/coolmath/assets/images/subscriptions/unlimited-playlists-small.png"><br><span class="white-txt"> Unlimited <br>Playlist </span></div></div></div><div class="better-focus-container "> <div class="all-excl-txt">And More Exclusive features for Premium Members!</div></div></div><div class="marketing-cmpn-footer"> <div class="bs-footer-link"> <a href="/premium-access/'+planToSubscription+'" target="_blank" onclick="cmgDefault_overlay_promo_signup_handler("Get CMGDefault Marketing screen mode - overlay button clicked"); return false;"><img src="/themes/custom/coolmath/assets/images/full-screen/get-premium-btn.png"></a> </div><div class="bs-learn-more"><a href="/premium-benefits" target="_blank" onclick="cmgDefault_overlay_promo_more_handler(); return false;" class="bs-lrn-more">Learn More</a></div><div class="bs-no-thks"><a href="" class="bs-lnk-lrn-more" onclick="supportCMG_overlay_promo_close_handler(); return false;">No, Thanks. I just want to play games right now.</a> </div></div></div></div>';
          jQuery(".field-game").append(htmlPopOver);
          jQuery("#videoplayer").hide();
          //localStorage.setItem("userPlayedGames"+currentMonth+currentYear,userPlayedGames); localStorage.setItem("userPlayedGames",userPlayedGames);
  
  } else if( typeof playListMktCmpGame != "undefined" && playListMktCmpGame == true && (gamesPlayed % 3 === 2)){
			/**
      *** Add free marketing promo Promo and check for every 3rd refresh
      ***/
      if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
            var planStripString = '4c044106';
          }else{
            var planStripString = '39980b12';
          }//logged in free user
       
      jQuery("#afg_container").hide();
      var playlistPopoverHtml = '<div id="id-playlist-marketing-campaign" class="playlist-marketing-campaign" > <div class="big-screen-head"> <div class="bs-head-logo"><img src="/themes/custom/coolmath/assets/images/full-screen/cool-math-logo.png"></div> <div class="bs-head-txt">Get Premium for Unlimited Playlists</div> <div class="bs-close-button"><a href="#" class="bs-close-btn" onclick="playlist_marketing_overlay_promo_close_handler(); return false;">X</a></div> </div> <div class="mid-big-section-head adfree-mid-section-marketing-campaign row"> <div class="mkt-container-co "> <div class=" para-1 mkt-container1"><img class="freind-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist_friendst-icon.png"></div> <div class="ad-free-txt txt-1">Collect, Organize and share!</div> <div class="para-4 mkt-container1"><img class="gift-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist_best-games-youve-never-heard-of.png"></div> </div> <div class="mkt-container-co"> <div class=" para-2 mkt-container1"><img class="cantstop-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist-cant-stop-playing-icon.png"></div> <div class="ad-free-txt txt-2">The games you want to live in <br> The Games that make you crazy </div> <div class="para-4 mkt-container1"><img class="fav-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist-favorites-icon.png"></div> </div> <div class="mkt-container-co"> <div class="para-3 mkt-container1"><img class="playhard-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist_hard-but-fun.png"></div> <div class="ad-free-txt txt-3">The games you love with your friends</div> <div class="para-3 mkt-container1 "><img class="eat-icon" src="/themes/custom/coolmath/assets/images/subscriptions/Playlist_want-to-eat-icon.png"></div> </div> <div class="playlist-promo-banner"> <img src="/themes/custom/coolmath/assets/images/subscriptions/playlist_promo_banner.png"> </div> <div class="marketing-cmpn-footer"> <div class="bs-footer-link"> <a href="/premium-access/'+planStripString+'" target="_blank" onclick="playlist_marketing_overlay_promo_signup_handler(); return false;"><img src="/themes/custom/coolmath/assets/images/full-screen/get-premium-btn.png"></a> </div> <div class="bs-learn-more"><a href="/premium-benefits" target="_blank" onclick="playlist_marketing_overlay_promo_more_handler(); return false;" class="bs-lrn-more">Learn More</a></div> <div class="bs-no-thks"><a href="" class="bs-lnk-lrn-more" onclick="playlist_marketing_overlay_promo_close_handler(); return false;">No, Thanks. I just want to play games right now.</a> </div> </div> </div> </div>';
      jQuery("#playlist-marketing-container-id").html(playlistPopoverHtml);
	    jQuery("#videoplayer").hide();
       

      //show bigscreen button
      $(document).ready(function () {
        if(jQuery('.immerse-button').length) {
          jQuery('#no-flash-overlay').hide();
          jQuery('#swfgamewrapper').hide();
        }
      });

	} else if ((drupalSettings.cmatgame.swfembed && !checkIfFlashIsEnabled()) || getCookie('cmg_schwl') !== null || typeof cmg_no_ads !== 'undefined' || (! validSubscriber && schoolHours) || (!schoolHours && !watchAdtoUnlockGame && !displayAdblockOverlay && ! supportCMG && !premiumAvatarGame)) { // school hours
      cmg_gdpr_check = getCookie("GDPR");
      var cmg_gdpr_first_check = getCookie("GDPR_First");
      var cmg_gdpr_reject_check = getCookie("GDPR_Reject");
      // remove ads for first party cookies or reject all cookies is present along with GDPR cookie
      if (cmg_gdpr_check !== null && (cmg_gdpr_first_check != null || cmg_gdpr_reject_check !== null)) {
        var adTagUrl = "";
        application = new Application(false, adTagUrl);
      } else if (getCookie('cmg_schwl') !== null || typeof cmg_no_ads !== 'undefined' || (drupalSettings.cmatgame.swfembed && !checkIfFlashIsEnabled())) {
        removePrerollAndDisplayGame();
        jQuery(document).ready(function () {
          display_game_progressbar(gameId);
        });
      } else if ((drupalSettings.cmatgame.swfembed && !checkIfFlashIsEnabled()) || getCookie('cmg_schwl') !== null || typeof cmg_no_ads !== 'undefined' || (!validSubscriber && schoolHours) || (!schoolHours && !watchAdtoUnlockGame && !displayAdblockOverlay && !supportCMG && !premiumAvatarGame)) {   //school hours
        cmg_gdpr_check = getCookie("GDPR");
        var cmg_gdpr_first_check = getCookie("GDPR_First");
        var cmg_gdpr_reject_check = getCookie("GDPR_Reject");
        //remove ads for first party cookies or reject all cookies is present along with GDPR cookie
        if (cmg_gdpr_check !== null && (cmg_gdpr_first_check != null || cmg_gdpr_reject_check !== null)) {
          var adTagUrl = "";
          application = new Application(false, adTagUrl);
        } else {
          /* Playwire video ad unit */
          jQuery('.game-progress-status').hide();
          var adTagUrl = 'https://pubads.g.doubleclick.net/gampad/ads?iu=/137548614/1023174/71134/1023174-71134-video&description_url=https%3A%2F%2Fwww.coolmathgames.com%2F&env=vp&impl=s&correlator=&tfcd=0&npa=0&gdfp_req=1&output=vast&sz=640x480&unviewed_position_start=1';
          if(typeof URLSearchParams !== 'undefined') {
            const params = new URLSearchParams(window.location.search);
            var prmname = params.get('test');
            if(prmname == "test"){
              jQuery("#afg_preloader").append('<div id="continue-container"><div id="img-button-container"><div id="img-button-self" class="img-button"> <input type="image" src="/themes/custom/cmatgame/images/CoolMathGames_skip-the-ads-button1b.png" alt="Submit"  class="skip-ad-btn"  onclick="redirectpremium();"></div><div class="continue-lnk-container-rsection"><div id="continue-link">Continue in </div><div id="timer_div" style="margin-left:5px;">15</div></div></div>' + signupContainerBottom);
            } else {
              jQuery("#continue-container").show();
              jQuery("#continue-container").append(signupContainerBottom);
            }
          } else {
            jQuery("#continue-container").show();
            jQuery("#continue-container").append(signupContainerBottom);
          }
          var swf_game_url = jQuery("#swfgame").attr("src");
          if (typeof swf_game_url !== 'undefined' && !checkIfFlashIsEnabled()) {
            application = new Application(false, adTagUrl);
          } else {
            if(typeof window.PW_CMG != "undefined") {
              var auctionCallback = function(displayAds, videoUrl){
                application = new Application(displayAds, videoUrl);
              };
              window.PW_CMG.startAuction(auctionCallback);
              //console.log("preroll window.PW_CMG.startAuction....");
            } else { //adblock
              application = new Application(false, adTagUrl);
            }
          }
        }

        if (!/0-chess/.test(window.location.pathname)) {
          //setCookie('cmg_active_anonymous_user', 'active', 30*60*1000);
        }
      } else if (!validSubscriber && (watchAdtoUnlockGame || displayAdblockOverlay || supportCMG || premiumAvatarGame) && getCookie('cmg_editor') === null) {
        //if user comes from google dont show the subscription paywall
        var ref = document.referrer;
      }
      if (!/0-chess/.test(window.location.pathname)) { // setCookie('cmg_active_anonymous_user', 'active', 30*60*1000);
      }
    } else if (! validSubscriber && !schoolHours && (watchAdtoUnlockGame || displayAdblockOverlay || supportCMG  || premiumAvatarGame) && getCookie('cmg_editor') === null) { // if user comes from google dont show the subscription paywall
      var ref = document.referrer;

      var validReferer = false;
      if (ref.match("google.com") !== null || ref.match("yahoo.com") !== null || ref.match("bing.com") !== null) {
        validReferer = true;
      }
      var watchPlay = 'Watch a quick video to <br/>unlock the game';
      var joinNowHeader = 'Become a Member';
      // use classes in Target to test 'join-now' or 'go-ad-free buttons
      if (displayAdblockOverlay === true) {
        // subscription Paywall for Adblock users
        // var watchAdButtonText = 'LEARN HOW';
        // Top of Ad Block Div
        var adBlockPremiumHeadline = '<span class="blue-headline-txt">Allow Ads</span> or <span class="yellow-headline-txt">Join!</span>';
        var adBlockSubHeadline = '<span class="blue-headline-txt">Turn Off Your Ad Blocker to  Keep Playing</span>';
        // Bottom of Ad Block Div
        var adBlockBottomPromo = '<span class="yellow-headline-txt">Or Go VIP Ad-Free Now</span>';
        var adBlockPromoPricing = '$5.99/month membership. Cancel Anytime';
        // Button Text
        var adBlockPremiumButton = 'Get Ad-Free';
          clearInterval(intervalId);
          jQuery("#afg_container").hide();
          jQuery(".title-instructions").remove();
          jQuery(".body-instructions").remove();

          jQuery("#continue-container").hide();
          doNotDisplayPrerollTimer = true;
          jQuery(".field-game").append(
            '<div class="blocker-detected-2">' +
              '<div class="row blocker-detected-top-content">' +
                '<h1>' + adBlockPremiumHeadline + '</h1>' +
                '<h2>' + adBlockSubHeadline + '</h2>' +
                '<div class="main-block-content">'+
                  '<div class="left-content-bullets">'+
                    '<ul>'+
                      '<li><div class="numberCircle">1</div><p>Click the Ad Blocker extension icon in the upper<br>right area of your browser window.</p></li>' +
                      '<li><div class="numberCircle">2</div><p>Choose â€œDon\â€™t run on this domainâ€ or similar <br>option to disable it for all Coolmath Pages.</p></li>' +
                      '<li><div class="numberCircle">3</div><p>Refresh the Page</p><br><a class="adblock-more-info-link" href="/adblock-faq" target="_blank">Having problems or need more info? Click here</a></li>' +
                    '</ul>'+
                  '</div>' +
                  '<div class="right-content-image"><img src="/sites/default/files/disable-adblocker.png" alt="disable ad blocker instructions" /></div>' +
                '</div>' +
              '</div>' +
              '<div class="row blocker-detected-bottom-content">' +
                '<div clas="left-bottom-content">' +
                  '<h3>' + adBlockBottomPromo + '</h3>' +
                  '<h4>' + adBlockPromoPricing + '<h4>' +
                '</div>' +
                '<div class="right-content-button-container"><div class="btn-container"><a class="btn sign-up vip-btn" id="adblock_join_now_promo_handler" href="premium-access/791c674d"><span>' + adBlockPremiumButton + '</span></a></div></div>' +
              '</div>' +
            '</div>'
          )
        } else if (!validReferer && premiumAvatarGame && gamesPlayed % 3 === 2) { //premiumAvatar promo games
          supportCMG = false;
          clearInterval(intervalId);
          jQuery("#afg_container").hide();
          jQuery(".title-instructions").remove();
          jQuery(".body-instructions").remove();
          jQuery("#continue-container").hide();
          doNotDisplayPrerollTimer = true;
          if( getCookie('cmg_fx') !== null && getCookie('cmg_sx') == null){
            var planToSubscription = '67361110';
          }else{
            var planToSubscription = '553bdf22';
          }
          jQuery(".field-game").append(
              '<div class="game-overlay-watch-or-join  premium-avatar">' +
              '<div class="big-screen-head row"><div class="bs-head-logo col-md-2"><img src="/themes/custom/coolmath/assets/images/full-screen/cool-math-logo.png"></div><div class="bs-head-txt col-md-8">Love The Games? Get The Avatars !</div> <div class="col-md-2"> <div class="bs-close-button"><a  href="#" class="bs-close-btn" onclick="adfree_marketing_overlay_promo_close_handler(); return false;">X</a></div> </div>     </div>'+
              '<div class="row overlay-logo-container">'+
              '</div>'+
              '<div class="row premium-avatar-content">'+

                '<img class="premium-avatar-banner" src="/sites/default/files/premium-avatar-promos/premium-avatar-overlay-1.png" />' +

                '<div class="premium-avatar-btn-container"> <a href="/premium-access/'+planToSubscription+'" target="_blank" onclick="cmgDefault_overlay_promo_signup_handler("Get Premium Avatar screen mode - overlay button clicked"); return false;"><img src="/themes/custom/coolmath/assets/images/full-screen/get-premium-btn.png"></a> '+
                '<div class="learn-more-text"><a class="learn-more-text-link" href="https://www.coolmathgames.com/premium-benefits" target="_blank"> Learn More</a></div>' +
                '<div class="no-thanks-text no-thanks-text-premium-avatar"><a href="javascript:premium_avatar_continue_to_game_handler();"> No, thanks. I just want to play games right now.</a></div>' +
              '</div></div>'+
            '</div>'
            );
          jQuery("#videoplayer").hide();

        }  else  if (!validReferer && watchAdtoUnlockGame) { //subscription paywall for WatchAd to Unlock Game
          //block anonymous users for New York City from 0-7am and 13pm to 11:59pm
          var watchAdHeadline = 'WATCH TO PLAY';
          var watchAdParagraphText = 'Watch a video to unlock <br> this game.';
          var watchAdButtonText = 'WATCH NOW';
          var joinNowHeadline = 'JOIN TO PLAY';
          var joinNowParagraphText = '$5.99/month membership<br>Cancel Anytime';
          var joinNowButtonText = 'Buy VIP Now';

          clearInterval(intervalId);
          jQuery("#afg_container").hide();
          jQuery(".title-instructions").remove();
          jQuery(".body-instructions").remove();
          jQuery("#continue-container").hide();
          doNotDisplayPrerollTimer = true;
          jQuery(".field-game").append(
            '<div class="game-overlay-watch-or-join">' +
              '<div class="row">'+
                // '<div class="container">'+
                //   '<h2 class="watch-join-top"><span class="watch-headline">WATCH</span> OR <span class="join-headline">JOIN</span></h2>'+
                // '</div>'+
              '</div>'+
              '<div class="row watch-join-content">'+
                '<div class="watch-to-play-container">'+
                  '<div class="watch-to-play"><h3>'+ watchAdHeadline +'</h3><div class="overlay-paragraph-text">'+ watchAdParagraphText +'</div></div>'+
                  '<div class="btn-container"><a class="btn btn-watch" href="javascript:unlock_now_promo_handler();">' + watchAdButtonText + '</a></div>'+
                '</div>'+
                '<div class="hr-line">&nbsp;</div>'+
                '<div class="vip-membership-container">'+
                  '<div class="watch-to-play"><h3>' + joinNowHeadline + '</h3><div class="overlay-paragraph-text">' + joinNowParagraphText + '</div></div>' +
                  '<div class="btn-container"><a class="btn sign-up vip-btn" id="join_now_promo_handler" href="/premium-access/849ef809">' + joinNowButtonText + '</a></div>'+
                '</div>'+
              '</div>'+
            '</div>'
          );

          jQuery("#videoplayer").hide();
          //localStorage.setItem("userPlayedGames"+currentMonth+currentYear,userPlayedGames); localStorage.setItem("userPlayedGames",userPlayedGames);
        } else {
          var adTagUrl = "";
          application = new Application(false, adTagUrl);
          if(typeof userPlayedGames !== 'undefined') {
            localStorage.setItem("userPlayedGames",userPlayedGames);//lifetime limit
          }
        }
      }
  </script>
</div>

<script type="text/javascript">
  function removeAdSwf() {
    removePrerollAndDisplayGame();
  }
  function noAdsReturned() { // enable_preroll_fallback_ads is false
    removePrerollAndDisplayGame();
  }
  function unlock_now_promo_handler() {
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    watchAdtoUnlockGameIsClicked = true;
    var auctionCallback = function (displayAds, videoUrl) {
      application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
      window.PW_CMG.startAuction(auctionCallback);
    }
  }

    function join_now_promo_handler() {
      if(typeof freeTrialUser !== 'undefined' && freeTrialUser) {
          trackEvent('Premium Subscription ' + subscriberLeg, 'Join Now or Go Ad Free button clicked', userPlayedGames);
          trackGoalVirtualPV('/virtual/join-now-overlay-click');
          trackEvent('Watch Ad to Unlock Game', 'Join now clicked', document.title);
      }
        return;
    }

    function unlock_promo_handler() {
    if(typeof freeTrialUser !== 'undefined' && freeTrialUser) {
      trackEvent('Watch to Unlock' +subscriberLeg, 'Watched an ad to unlock event', userPlayedGames);
      trackGoalVirtualPV('/virtual/unlock-button-click');
    }
    return;
  }
  function continue_to_game_handler() {
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    supportCMGisClicked = true;
    trackEvent('Support CMG', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
      application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
      window.PW_CMG.startAuction(auctionCallback);
    }
  }

    function premium_avatar_continue_to_game_handler() {
      jQuery(".subscription-overlay").remove();
      jQuery(".game-overlay-watch-or-join").remove();
      jQuery("#afg_container").show();
      jQuery("#videoplayer").show();
      jQuery("#continue-link").text("Continue in ");
      jQuery("#continue-container").show();
      jQuery("#continue-container").append(signupContainerBottom);
      doNotDisplayPrerollTimer = false;
      displayPrerollTimer();
      // supportCMGisClicked = true;
      trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
      var auctionCallback = function(displayAds, videoUrl){
        application = new Application(displayAds, videoUrl);
      };
      if(typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
      }
    }
    function support_cmg_signup_promo_handler(){
      if(typeof freeTrialUser !== 'undefined' && freeTrialUser) {
          trackEvent('Premium Subscription ' +subscriberLeg, 'Support CMG button clicked', userPlayedGames);
          trackGoalVirtualPV('/virtual/join-now-overlay-click');
          trackEvent('Support CMG', 'Join now clicked', document.title);
      }
    }
    jQuery('#support_cmg_signup_promo_handler').click(function(event) {
      event.preventDefault();
      var path = '/premium-access/0735a1f2';
      var sLeg = get_premium_access_leg_desc('0735a1f2');
      if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
        path = '/premium-access/d61242ac';
        sLeg = get_premium_access_leg_desc('d61242ac');
      }
      if(typeof get_signup_abtest_variant_2 === 'function') {
        path = path + get_signup_abtest_variant_2();
      }
      if(typeof freeTrialUser !== 'undefined' && freeTrialUser) {
        trackEvent('Premium Subscription ' + sLeg, 'Support CMG button clicked', userPlayedGames);
        trackGoalVirtualPV('/virtual/join-now-overlay-click');
        trackEvent('Support CMG', 'Join now clicked', document.title);
      }
      window.location.href = window.location.protocol + '//' + window.location.host + path;
    });
    jQuery('#premium_avatar_signup_promo_handler').click(function(event) {
      event.preventDefault();
      var sLeg = get_premium_access_leg_desc('553bdf22');
      var path = '/premium-access/553bdf22';
      if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
        path = '/premium-access/67361110';
        sLeg = get_premium_access_leg_desc('67361110');
      }
      if(typeof get_signup_abtest_variant_2 === 'function') {
        path = path + get_signup_abtest_variant_2();
      }
      if(typeof freeTrialUser !== 'undefined' && freeTrialUser) {
        trackEvent('Premium Subscription ' + sLeg, 'Premium Avatar button clicked', userPlayedGames);
        trackGoalVirtualPV('/virtual/join-now-overlay-click');
        trackEvent('Premium Avatar', 'Join now clicked', document.title);
      }
      window.location.href = window.location.protocol + '//' + window.location.host + path;
    });


  </script>

<script type="text/javascript">
jQuery(document).ready(function () {
  cmatgame_subscriber = getCookie("cmg_sx");
  if(typeof getCookie === 'function' && getCookie("cmg_wl") !== null) {
    cmatgame_subscriber = getCookie("cmg_wl");
  }
  // check if school is whitelisted
  if (cmg_school_whitelisted !== null && getCookie("cmg_schwl") !== null) {
    cmg_school_whitelisted = getCookie("cmg_schwl");
    cmatgame_subscriber = getCookie("cmg_schwl");
  } else if (cmg_school_whitelisted === null && typeof cmg_no_ads_debug !== "undefined" && cmg_no_ads_debug) { // console.log("KY school hours");
    cmatgame_subscriber = cmg_no_ads_debug;
  }
  if (cmg_gdpr_check !== null) {
    var cmg_gdpr_all_check = getCookie("GDPR_All"); // GDPR_All cookie is set when user selects accept all cookies in the GDPR overlay
    var cmg_gdpr_first_check = getCookie("GDPR_First");
    var cmg_gdpr_reject_check = getCookie("GDPR_Reject");
    if (cmg_gdpr_all_check == null && (cmg_gdpr_first_check != null || cmg_gdpr_reject_check != null)) { // user either accepted only first party cookies or rejected all cookies so do not display ads
      cmatgame_subscriber = getCookie("GDPR");
    } else if (cmg_gdpr_all_check == null && cmg_gdpr_first_check == null && cmg_gdpr_reject_check == null) { // user is coming for the first time from one of the GDPR countries so do not display ads
      cmatgame_subscriber = getCookie("GDPR");
    }
  }
  immersive_mode_display_controller();
  if (getCookie('cmg_sx') !== null || getCookie("cmg_wl") !== null) { // display xp bar for premium users
    $('.game-xp-bar-immerse-button').addClass('enabled');
    jQuery('.btn.btn-primary.btn-sm.requestfullscreen').css('display', 'inline-block');
  }

  // display_game_progressbar(gameId);

  // VooxeVideo
  if (jQuery('#videoContainer').length && typeof VooxeVideo === 'undefined') {
    trackEvent('Video Walkthrough', 'Walkthrough video not found', document.title);
    jQuery('#videoContainer').hide();
  }
})


if (browser == "Microsoft Internet Explorer") {
  if (doesnotie == 1) {
    var IEDoesnotwork = "yes";
    doesnotIEMessage();
  } else {
    var IEDoesnotwork = "no";
  }
}
function closeBigScreenPromo() {
    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    // supportCMGisClicked = true;
    trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}


function premium_avatar_overlay_promo_signup_handler(promo_action){
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/553bdf22';
  
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('553bdf22');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
    path = '/premium-access/67361110';
    sLeg = get_premium_access_leg_desc('67361110');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}

function cmgDefault_overlay_promo_signup_handler(promo_action){
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/0735a1f2';
  var sAction = 'Get CMGDefault Marketing screen mode - overlay button clicked';
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('0735a1f2');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
    path = '/premium-access/d61242ac';
    sLeg = get_premium_access_leg_desc('d61242ac');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}


function supportCMG_overlay_promo_close_handler(){
    event.preventDefault();
    var sLeg = '';
    var path = '/premium-access/0735a1f2';
    var sAction = 'Close Adfree Marketing overlay clicked';
    sLeg = get_premium_access_leg_desc('0735a1f2');//Anon user
    if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
      path = '/premium-access/d61242ac';
      sLeg = get_premium_access_leg_desc('d61242ac');//freemium user
    }
    trackEvent('cmgDefault Marketing overlay', sAction, document.title);
    if(jQuery("#id-cmg-default").length) {
       jQuery("#id-cmg-default").hide();
    }
    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    //jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    // supportCMGisClicked = true;
    //trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}


function adfree_marketing_overlay_promo_signup_handler(promo_action) {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/b2df5a33';
  var sAction = 'Get Adfree Marketing screen mode - overlay button clicked';
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('b2df5a33');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null)) {
    path = '/premium-access/0c5a2b5b';
    sLeg = get_premium_access_leg_desc('0c5a2b5b');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}

function adfree_marketing_overlay_promo_close_handler() {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/b2df5a33';
  var sAction = 'Close Adfree Marketing overlay clicked';
  sLeg = get_premium_access_leg_desc('b2df5a33');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
    path = '/premium-access/0c5a2b5b';
    sLeg = get_premium_access_leg_desc('0c5a2b5b');//freemium user
  }
  trackEvent('Adfree Marketing overlay', sAction, document.title);
  if(jQuery("#id-adfree-marketing-campaign").length) {
    jQuery("#id-adfree-marketing-campaign").hide();
  }

    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    //jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    // supportCMGisClicked = true;
    //trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}

function adfree_marketing_overlay_promo_more_handler() {
  event.preventDefault();
  var sAction = 'Adfree Marketing overlay learn more clicked';
  trackEvent('Adfree Marketing overlay', sAction, document.title);
  var redirect_url = window.location.protocol + '//' + window.location.host + "/premium-benefits";
  window.open( redirect_url , '_blank');
}


function closeBigScreenPromo() {
    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    // supportCMGisClicked = true;
    trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}

function bigscreen_overlay_promo_signup_handler(promo_action) {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/6ea95de6';
  var sAction = 'Get big screen mode - overlay button clicked';
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('6ea95de6');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && (getCookie('cmg_sx') === null && getCookie('cmg_wl') === null)) {
    path = '/premium-access/89bee87a';
    sLeg = get_premium_access_leg_desc('89bee87a');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}

function bigscreen_overlay_promo_close_handler() {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/6ea95de6';
  var sAction = 'Close premium overlay clicked';
  sLeg = get_premium_access_leg_desc('6ea95de6');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
    path = '/premium-access/89bee87a';
    sLeg = get_premium_access_leg_desc('89bee87a');//freemium user
  }
  trackEvent('Big screen overlay', sAction, document.title);
  if(jQuery("#big-screen-container").length) {
    jQuery("#big-screen-container").hide();
  }
    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    //jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
   
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };

    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}

function bigscreen_overlay_promo_more_handler() {
  event.preventDefault();
  var sAction = 'Premium overlay learn more clicked';
  trackEvent('Big screen overlay', sAction, document.title);
  var redirect_url = window.location.protocol + '//' + window.location.host + "/premium-benefits";
  window.open( redirect_url , '_blank');
}


function playlist_marketing_overlay_promo_signup_handler() {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/39980b12';
  var sAction = 'Get playlist Marketing screen mode - overlay button clicked';
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('39980b12');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
    path = '/premium-access/4c044106';
    sLeg = get_premium_access_leg_desc('4c044106');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}

function playlist_marketing_overlay_promo_close_handler(){
    event.preventDefault();
    var sLeg = '';
    var path = '/premium-access/39980b12';
    var sAction = 'Close Playlist Marketing overlay clicked';
    sLeg = get_premium_access_leg_desc('39980b12');//Anon user
    if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null && getCookie('cmg_wl') === null) {
      path = '/premium-access/4c044106';
      sLeg = get_premium_access_leg_desc('4c044106');//freemium user
    }
    trackEvent('Playlist Marketing overlay', sAction, document.title);
    if(jQuery("#id-playlist-marketing-campaign").length) {
      jQuery("#id-playlist-marketing-campaign").hide();
    }
    
    jQuery("#full-screen-modal").remove();
    jQuery(".subscription-overlay").remove();
    jQuery(".game-overlay-watch-or-join").remove();
    jQuery('#big-screen-container').remove();
    //jQuery('#no-flash-overlay').show();
    jQuery("#swfgamewrapper").show();
    jQuery("#afg_container").show();
    jQuery("#videoplayer").show();
    jQuery("#continue-link").text("Continue in ");
    jQuery("#continue-container").show();
    jQuery("#continue-container").append(signupContainerBottom);
    doNotDisplayPrerollTimer = false;
    displayPrerollTimer();
    // supportCMGisClicked = true;
    //trackEvent('Premium Avatar', 'Continue to Game Button clicked', document.title);
    var auctionCallback = function (displayAds, videoUrl) {
        application = new Application(displayAds, videoUrl);
    };
    if (typeof window.PW_CMG != "undefined") {
        window.PW_CMG.startAuction(auctionCallback);
    }
}

function playlist_banner_right_sidebar_handler() {
  event.preventDefault();
  var sLeg = '';
  var path = '/premium-access/a1ca2f3b';
  var sAction = 'Get playlist banner screen mode - masthead clicked';
  if(typeof promo_action !== 'undefined' && promo_action !== '') {
    sAction = promo_action;
  }
  sLeg = get_premium_access_leg_desc('a1ca2f3b');//Anon user
  if(typeof getCookie === 'function' && getCookie('cmg_fx') !== null && getCookie('cmg_sx') === null) {
    path = '/premium-access/780ef8a3';
    sLeg = get_premium_access_leg_desc('780ef8a3');//freemium user
  }
  trackEvent('Premium Subscription - '+sLeg, sAction, document.title);
  if(typeof get_signup_abtest_variant_2 === 'function') {
    path = path + get_signup_abtest_variant_2();
  }
  window.location.href = window.location.protocol + '//' + window.location.host + path;//cmg
}


function playlist_marketing_overlay_promo_more_handler() {
  event.preventDefault();
  var sAction = 'Playlist Marketing overlay learn more clicked';
  trackEvent('Playlist Marketing overlay', sAction, document.title);
  var redirect_url = window.location.protocol + '//' + window.location.host + "/premium-benefits";
  window.open( redirect_url , '_blank');
}

</script>
<script type='text/javascript' src='https://static.truex.com/js/client.js'></script>



      <div class="row mt-3 mb-1 game-xp-bar-immerse-button">
        <div class="col-sm-6 game-xp-bar"><div class="game-progress-status"><div class="progress game-xp-progress" style="display:none;"><div class="progress-text"><a href="/login">Login to Earn XP</a></div><div class="progress-bar" role="progressbar" style="width:70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div></div></div></div>
        <div class="col-sm-6 immerse-close-button">
          <div class="immerse-button">
          	<a class="btn btn-primary btn-sm requestfullscreen" href="#" title="Big Screen">
          		<span class="big-screen-popover-span">Big Screen</span>
          		<i class="fa fa-arrows-alt" aria-hidden="true"></i>
          	</a>
          </div>
                    <div class="close-full-screen">
            <a class="btn btn-primary btn-fullscreen btn-sm" href="#" title="Exit Big Screen">
              <span>Exit Big Screen</span> <i class="fa fa-times-circle" aria-hidden="true"></i>
            </a>
          </div>
        </div>
      </div>

      <div class="field field--name-field-instructions field--type-text-with-summary field--label-above field__items"><h3 class="title-instructions field__label">Instructions</h3><div class="body-instructions field__item"> <p>Click on a brick to break it and score points. Use points to purchase new balls with different abilities and upgrade them. Balls will automatically bounce and break bricks to score more points.</p>

<p>&nbsp;</p>

<p>For maximum brick-busting, determine which upgrades are most efficient. What is the best way to spend your money: more balls, more speed, more power? It gets complicated fast!</p>
</div></div>

    </div>
  </article>
</div>

    </div>
  </div>

<div class="views-element-container block block-views block-views-blockgame-queues-block-2" id="block-views-block-game-queues-block-2">
  
      <h2 class="common-title">
      <span class="title-with-button">Coolmath Top Picks</span>
    </h2>
    
      <div class="view-content">
      <div><div class="pane-content js-view-dom-id-41d92df42454221113a5290c7c186a6d1647bd91dcb0881c58cef2459b751eb7">
  
  
  

  
  
  

      <div class="views-row">  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-chess">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Chess Game" title="Chess" data-src="/sites/default/files/styles/thumbnail_small/public/chess-icon.png?itok=v9F2dhmN" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Chess</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Checkmate! Play the classic game of strategy. You can challenge the computer, a friend, or join a match against another online player.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-swing-monkey">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Swing Monkey Game" title="Swing Monkey" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/swing-monkey-game-logo.png?itok=Z7uSpeaQ" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Swing Monkey</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Swing through the jungle from tree to tree! Beat levels to unlock new monkey skins.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-copter-royale">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Copter Royale Game" title="Copter Royale" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/copter-royale-game-logo_0.png?itok=mBoa4U1x" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Copter Royale</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Outlast your opponents in the ultimate copter arena. Grab upgrades and superpowers, avoid the toxic fog, and be the last one flying!</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-poptropica">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Poptropica Game" title="Poptropica" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/poptropica-game-logo.png?itok=F32EkkMW" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Poptropica</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Hop in your hot air balloon and prepare for adventure! Solve a whole new quest on every island.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-darts">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Darts Game" title="Darts" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/darts-game-logo.png?itok=lm-u2aAw" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Darts</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Test your aim in online multiplayer! Race your opponent to get to zero first. You'll have to calculate your own score.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-retro-ping-pong">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Retro Ping Pong Game" title="Retro Ping Pong" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/retro-ping-pong-game-logo_1.png?itok=4XqD0w1_" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Retro Ping Pong</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Play the classic game, or mix it up with an all-new action mode:&nbsp;fireballs, blasters, gravity wells, and more!</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-big-tower-tiny-square">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Big Tower Tiny Square Game" title="Big Tower Tiny Square" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/big-tower-tiny-square-game-logo.png?itok=gzYesemP" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Big Tower Tiny Square</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Your pineapple is trapped at the top of a huge tower!&nbsp;Jump over pits of lava and dodge dangerous traps to rescue it.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-pre-civilization-bronze-age">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Pre-Civilization Bronze Age Game" title="Pre-Civilization Bronze Age" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/game-logo-preciv-bronze-age_0.gif?itok=M2xJ4brL" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Pre-Civilization Bronze Age</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Grow your civilization during the Bronze Age. Collect food, research technology, defend yourself from other civilizations,&nbsp;and build a world wonder!</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-jumpless-world">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Jumpless World Game" title="Jumpless World" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/jumpless-world-game-logo.png?itok=1icG0uou" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Jumpless World</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>In this strange and unusual world, you cannot jump. Fortunately, you CAN summon mountains beneath your feet. And get filthy stinkin' rich.</p>
</div>
    </div>
  </div>
  <div class="game-item">
    <div class="game-link-wrapper">
	  <a href="/0-idle-dice">
	    <div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Idle Dice Game" title="Idle Dice" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/idle-dice-game-logo.png?itok=iqbMD_SA" class="lazyload" typeof="foaf:Image" />

</div>
		<h3 class="game-title">Idle Dice</h3>
	  </a>
    </div>
    <div class="game-item-description">
	  <div class="field-body"><p>Let's get rolling! It may not look like much at first, but we have a feeling you'll be earning trillions of points in no time.</p>
</div>
    </div>
  </div>
  </div>

    

  
  

  
  
</div>
</div>

    </div>
  </div>


                  </div>
                </div>
              </div>
                                
<div id="block-adsbottom-otherpage-728x90" class="block block-cmatgame-core block-adsbottom-otherpage-728x90">
  
    
      <div class="view-content">
      <div class="panel-pane pane-block pane-cmatgame-advertisement-cm-g-otherpages-728x90-footer"><div class="ad-wrapper"><!-- 728 x 90 BTF Desktop --><div id="leaderboard-btf"></div></div></div>
    </div>
  </div>


                          </div>
          </section>
        </main>
                  <div class="main-aside">
            <aside class="section" role="complementary">
              <div class="inside">
                  <div id="block-playlistrightsidebanner-2" class="block block-block-content block-block-content4c6a7813-867a-4112-a837-b6fd47fe8607">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="right-rail-playlist-marketing-promo" class="playlist-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="playlist_marketing_overlay_promo_signup_handler('Get Playlist marketing - Right Sidebar Promo clicked')"><img src="sites/default/files/cmatgame_block/CoolMathGames_banner9b_300x102.png"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-premiumavatarrightsideblock-2" class="block block-block-content block-block-content0d921a13-9d4c-4d2d-a35f-a5e8338c57a1">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="premium-avatar-right-side-ad" class="premium-avatar-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="premium_avatar_overlay_promo_signup_handler('Get Premium Avatar - Right Sidebar Promo clicked')"><img src="sites/default/files/cmatgame_block/300x102-banner-based-on-assets-9c.jpg"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-cmgdefaultrightsidebar" class="block block-block-content block-block-content8dc48050-ab81-4362-99e4-da7de575f675">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="cmgdefault-right-side-ad" class="cmgdefault-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="cmgDefault_overlay_promo_signup_handler('Get CMGDefault Marketing screen mode - overlay button clicked')"><img src="/sites/default/files/cmatgame_block/CoolMathGames_banner13_300x102.gif"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>

<div id="block-adsrighttop-otherpage-300x250" class="block block-cmatgame-core block-adsrighttop-otherpage-300x250">
  
    
      <div class="view-content">
      <div class="panel-pane pane-block pane-cmatgame-advertisement-cm-g-otherpages-300x250-top other-pages-300x250"><div class="ad-wrapper"><!-- 300 x 250 ATF Desktop --><div id="med-rect-atf"></div></div></div>
    </div>
  </div>

<div id="block-adsrightcenter-otherpage-300x250" class="block block-cmatgame-core block-adsrightcenter-otherpage-300x250">
  
    
      <div class="view-content">
      <div class="panel-pane pane-block pane-cmatgame-advertisement-cm-g-otherpages-300x250-center other-pages-300x250"><div class="ad-wrapper"><!-- 300 x 250 ATF Desktop --><div id="med-rect-btf"></div></div></div>
    </div>
  </div>
<div id="block-playlistrightsidebanner" class="block block-block-content block-block-content4c6a7813-867a-4112-a837-b6fd47fe8607">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="right-rail-playlist-marketing-promo" class="playlist-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="playlist_marketing_overlay_promo_signup_handler('Get Playlist marketing - Right Sidebar Promo clicked')"><img src="sites/default/files/cmatgame_block/CoolMathGames_banner9b_300x102.png"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-premiumavatarrightsideblock" class="block block-block-content block-block-content0d921a13-9d4c-4d2d-a35f-a5e8338c57a1">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="premium-avatar-right-side-ad" class="premium-avatar-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="premium_avatar_overlay_promo_signup_handler('Get Premium Avatar - Right Sidebar Promo clicked')"><img src="sites/default/files/cmatgame_block/300x102-banner-based-on-assets-9c.jpg"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-cmgdefaultrightsidebar-2" class="block block-block-content block-block-content8dc48050-ab81-4362-99e4-da7de575f675">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="cmgdefault-right-side-ad" class="cmgdefault-right-side-promo"  style="display:none;"><a href="javascript:void(0);" onclick="cmgDefault_overlay_promo_signup_handler('Get CMGDefault Marketing screen mode - overlay button clicked')"><img src="/sites/default/files/cmatgame_block/CoolMathGames_banner13_300x102.gif"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-nodepagespromouserprofiles" class="block block-block-content block-block-content94913ff6-dd14-4345-8c90-e12e39b0e2f8">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <style>
.profiles-promo{
  background: url('/sites/default/files/profiles-right-rail_3.png')no-repeat;
  height: 102px;
  width: 300px;
  display: block;
  text-indent: -9999px;
  background-position: top center;
  margin-bottom: 44px;
}
a:hover{
    background-position: bottom center;
}

</style>

<a class="profiles-promo" href="/signup">User Profiles</a>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-leaderboardpromorightrail-2" class="block block-block-content block-block-contentdbed06d8-7595-4402-a8df-39e62a69ca98">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div class="leaderboard-promo"><a href="/profile/leaderboard"><img src="/sites/default/files/cmatgame_block/leaderboards-right-rail-hover.png"></a></div>
            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>
<div id="block-rightrailblockallgamesaz" class="block block-block-content block-block-contentdb7b8c07-768c-46b3-8588-bb5c7075ed3f">
    
        
              <div class="field field--name-body field--type-text-with-summary field--label-hidden field__items">
                <div class="field__item">
        <div id="trendi-container" style="margin-bottom: 50px;">Â </div>

<div class="aside-link-title"><a href="/1-complete-game-list?rightrail">All Games A-Z</a></div>

            </div>
          </div>
<div class="right-rail-promo"></div>
      </div>


              </div>
                              <div class="promo clearfix">
                  <div class="inside">
                      
<div id="block-rightrailpromogames" class="block block-cmatgame-core block-rightrailpromogames">
  
    
      <div class="view-content">
      <div class="panel-pane pane-views-panes pane-queues-view-rightrail-games-promo"><h2 class="pane-title"><a href="/1-aiming-games">Aiming Games</a></h2><div class="node-game"><a href="/0-archery-world-tour"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Archery World Tour Game" title="Archery World Tour" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/archery-world-tour.png?itok=q1Uwb7xx" class="lazyload" typeof="Image" />

</div><h3 class="game-title">Archery World Tour</h3></a></div><div class="node-game"><a href="/0-arcade-golf-neon"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Arcade Golf Neon Game" title="Arcade Golf Neon" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/arcade-golf-neon-game-logo.png?itok=JkOWTpb7" class="lazyload" typeof="Image" />

</div><h3 class="game-title">Arcade Golf Neon</h3></a></div><div class="node-game"><a href="/0-basketball-master-2"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Basketball Master 2 Game" title="Basketball Master 2" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/basketball-master-2-game-logo.png?itok=jgUijnnq" class="lazyload" typeof="Image" />

</div><h3 class="game-title">Basketball Master 2</h3></a></div><div class="node-game"><a href="/0-iq-ball"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="IQ Ball Game" title="IQ Ball" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/game-logo-iq-ball.gif?itok=uxRL9p9g" class="lazyload" typeof="Image" />

</div><h3 class="game-title">IQ Ball</h3></a></div><div class="node-game"><a href="/0-raft-wars"><div class="field-image"><img src="/modules/custom/cmatgame_core/images/1x1.png" width="83" height="50" alt="Raft Wars Game" title="Raft Wars" data-src="/sites/default/files/styles/thumbnail_small/public/game_thumbnail/raft-wars-game-logo.png?itok=W_kSfO7L" class="lazyload" typeof="Image" />

</div><h3 class="game-title">Raft Wars</h3></a></div></div>
    </div>
  </div>

<div id="block-adsrightbottom-otherpage-160x600" class="block block-cmatgame-core block-adsrightbottom-otherpage-160x600">
  
    
      <div class="view-content">
      <div class="panel-pane pane-block pane-cmatgame-advertisement-cm-g-otherpages-160x600-bottom other-pages-160x600"><div class="ad-wrapper"><!-- 160 x 600 Skyscraper Desktop --><div id="sky-btf"></div></div></div>
    </div>
  </div>


                  </div>
                </div>
                          </aside>
          </div>
              </div>
    </div>
  </div>
 <footer class="page__footer">
	<div class="container">
		<div class="row pb-3">
			<div class="col-md-2"></div>
			<div class="col-md-10">
				<div class="item-list">
					<ol>
													<li>&nbsp;</li>
							<li>&nbsp;</li>
												<li>
							<div class="pane-bean-footer-pivacy-policy">
								<div class="link-with-body-title">
									<a href="/privacyp">Coolmath games privacy policy</a>
								</div>
								<div class="field-text-block">
									<p>If you believe that your own copyrighted content is on our Site without your permission, please follow this&nbsp;<a href="http://coolmath.com/copyright-infringement-notice-procedure">Copyright Infringement Notice procedure</a>.</p>
								</div>
							</div>
						</li>
													<li>
								  <nav role="navigation" aria-labelledby="block-desktopfootermenu-menu" id="block-desktopfootermenu">
            
  <h2 class="visually-hidden" id="block-desktopfootermenu-menu">Desktop Footer menu</h2>
  

        
      <div class="panel-pane pane-menu-tree pane-menu-desktop-footer-menu">
      <div class="menu-name-menu-desktop-footer-menu">
                          <ul class="footer-menu">
                                                  <li class="menu__item is-expanded expanded footer-menu-column-0">
                                            <span class="menu__link nolink">COOLMATHGAMES.COM</span>
                                                                  <ul class="footer-menu">
                                                      <li >
                                                            <a href="/about-us" data-drupal-link-system-path="node/9901">About Us</a>
                                        </li>
                                                      <li >
                                                            <a href="/terms-use" data-drupal-link-system-path="node/9906">Terms of Use</a>
                                        </li>
                                                      <li >
                                                            <a href="/aboutourads" data-drupal-link-system-path="node/12889">About Our Ads</a>
                                        </li>
                                                      <li >
                                                            <a href="/subscription-faq" data-drupal-link-system-path="node/10921">Subscription FAQ</a>
                                        </li>
                                                      <li >
                                                            <a href="/adblock-faq" data-drupal-link-system-path="node/12937">Adblock FAQ</a>
                                        </li>
                                                      <li >
                                                            <a href="/contact-us-about-subscriptions" data-drupal-link-system-path="node/11046">Subscription Support</a>
                                        </li>
                                                      <li >
                                                            <a href="/blog" data-drupal-link-system-path="blog">Blog</a>
                                        </li>
                                                      <li >
                                                            <a href="/contact-us" data-drupal-link-system-path="node/12581">CONTACT US</a>
                                        </li>
                  </ul>
            
                          </li>
                                                  <li class="menu__item is-expanded expanded footer-menu-column-1">
                                            <span class="menu__link nolink">BROWSE GAMES</span>
                                                                  <ul class="footer-menu">
                                                      <li >
                                                            <a href="/1-strategy-games" title="Strategy Games" data-drupal-link-system-path="taxonomy/term/6">Strategy Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-skill-games" title="Skill Games" data-drupal-link-system-path="taxonomy/term/46">Skill Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-number-games" title="Number Games" data-drupal-link-system-path="taxonomy/term/151">Number Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-logic-games" title="Logic Games" data-drupal-link-system-path="taxonomy/term/91">Logic Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-memory-games" title="Memory Games" data-drupal-link-system-path="taxonomy/term/181">Memory Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-classic-games" title="Classic Games" data-drupal-link-system-path="taxonomy/term/211">Classic Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/0-jigsaw-puzzles" title="Jigsaw Puzzles" data-drupal-link-system-path="0-jigsaw-puzzles">Jigsaw Puzzles</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-science-games" title="Science Games" data-drupal-link-system-path="taxonomy/term/626">Science Games</a>
                                        </li>
                                                      <li >
                                                            <a href="/1-geography-games" title="Geography Games" data-drupal-link-system-path="taxonomy/term/206">Geography Games</a>
                                        </li>
                  </ul>
            
                          </li>
                                                  <li class="menu__item is-expanded expanded footer-menu-column-2">
                                            <span class="menu__link nolink">COOLMATH.COM</span>
                                                                  <ul class="footer-menu">
                                                      <li >
                                                            <a href="https://www.coolmath.com/prealgebra" title="Pre-Algebra Lessons">Pre-Algebra Lessons</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/algebra" title="Algebra Lessons">Algebra Lessons</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/precalculus-review-calculus-intro" title="Pre-Calculus Lessons">Pre-Calculus Lessons</a>
                                        </li>
                                                      <li >
                                                            <a href="https://coolmath.com/reference/online-math-dictionary" title="Math Dictionary">Math Dictionary</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/algebra/08-lines" title="Lines">Lines</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/prealgebra/00-factors-primes" title="Factors and Primes">Factors and Primes</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/prealgebra/02-decimals" title="Decimals">Decimals</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath.com/prealgebra/06-properties" title="Properties">Properties</a>
                                        </li>
                  </ul>
            
                          </li>
                                                  <li class="menu__item is-expanded expanded footer-menu-column-3">
                                            <span class="menu__link nolink">MORE FROM COOLMATH</span>
                                                                  <ul class="footer-menu">
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com" title="Coolmath4Kids">Coolmath4Kids</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com/manipulatives/ten-frame" title="Ten Frame Manipulative">Ten Frame Manipulative</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com/manipulatives/base-ten-blocks" title="Base Ten Blocks Manipulative">Base Ten Blocks Manipulative</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com/manipulatives/number-line" title="Number Line Manipulative">Number Line Manipulative</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com/manipulatives/pattern-blocks" title="Pattern Blocks Manipulative">Pattern Blocks Manipulative</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.coolmath4kids.com/quizzes" title="Math Quizzes">Math Quizzes</a>
                                        </li>
                                                      <li >
                                                            <a href="http://www.coolmath4teachers.com" title="Coolmath4Teachers">Coolmath4Teachers</a>
                                        </li>
                                                      <li >
                                                            <a href="http://www.coolmath4parents.com" title="Coolmath4Parents">Coolmath4Parents</a>
                                        </li>
                  </ul>
            
                          </li>
                                                  <li class="menu__item is-expanded expanded footer-menu-column-4">
                                            <span class="menu__link nolink">Follow us</span>
                                                                  <ul class="footer-menu">
                                                      <li >
                                                            <a href="https://www.facebook.com/CoolMathGamesLLC">Facebook</a>
                                        </li>
                                                      <li >
                                                            <a href="https://www.instagram.com/coolmathgames/">Instagram</a>
                                        </li>
                                                      <li >
                                                            <a href="https://twitter.com/TheRealCoolmath">Twitter</a>
                                        </li>
                  </ul>
            
                          </li>
                  </ul>
                  </div>
    </div>
  

  </nav>


							</li>
												<li>
							<div class="copyright-wrapper text-left">
								<p>Â© 2020 Coolmath.com LLC. All Rights Reserved.
								</p>
							</div>
						</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
</footer>
</div>

  </div>

          
          <script src="/sites/default/files/js/js_o3vgCZhUwqycJe1zXqt4wkp99ynvtFEh5rHbw9aWBso.js"></script>

            
            <script type="text/javascript">
              if (jQuery('body').hasClass('node-type-game')) {
                var offset = 420;
                var offsetMillis = offset * 60 * 1000;
                var today = new Date();
                var millis = today.getTime();
                var timeZoneOffset = (today.getTimezoneOffset() * 60 * 1000);
                var pst = millis - offsetMillis;
                var currentDate = new Date(pst);
                var dayarray = [
                  'Sunday',
                  'Monday',
                  'Tuesday',
                  'Wednesday',
                  'Thursday',
                  'Friday',
                  'Saturday'
                ];
                var montharray = [
                  'Jan.',
                  'Feb.',
                  'Mar.',
                  'Apr.',
                  'May.',
                  'Jun.',
                  'Jul.',
                  'Aug.',
                  'Sep.',
                  'Oct.',
                  'Nov.',
                  'Dec.'
                ];
                var displaydate = dayarray[currentDate.getDay()] + ", " + montharray[currentDate.getMonth()] + " " + ordinal_suffix_of(currentDate.getDate());
                jQuery('.node-type-game .global-wrapper-content .dailygames .common-title').html(
                  "<div class='daily-games-text'><img src='/themes/custom/cmatgame/images/bird.png' alt='daily games' class='daily-games-header' /></div><span class='dailygamesdate'>" + displaydate + "</span>"
                );
              }
            </script>
            <script id="profitwell-js" data-pw-auth="112ca5554aa368c7638df5177116c556">
              (function(i,s,o,g,r,a,m){i[o]=i[o]||function(){(i[o].q=i[o].q||[]).push(arguments)};
              a=s.createElement(g);m=s.getElementsByTagName(g)[0];a.async=1;a.src=r+'?auth='+
              s.getElementById(o+'-js').getAttribute('data-pw-auth');m.parentNode.insertBefore(a,m);
              })(window,document,'profitwell','script','https://public.profitwell.com/js/profitwell.js');
              profitwell('start', {});
            </script>
          </body>
        </html>
